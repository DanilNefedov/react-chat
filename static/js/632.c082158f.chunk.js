"use strict";(self.webpackChunkmy_app=self.webpackChunkmy_app||[]).push([[632],{8552:function(e,s,t){t(2791);s.Z=t.p+"static/media/edit.666b6fca3a40a0415e39054d202d0667.svg"},3632:function(e,s,t){t.r(s),t.d(s,{default:function(){return D}});var n=t(4165),a=t(5861),r=t(885),i=t(7689),d=t(1087),c={header:"MessagesMain_header__EMkYa",or:"MessagesMain_or__g5wuD",user:"MessagesMain_user__TDMJA",userImg:"MessagesMain_userImg__Mop0A",name:"MessagesMain_name__58IH7",online:"MessagesMain_online__FByeQ",dots:"MessagesMain_dots__9N9pU",container:"MessagesMain_container__c2E6N",input:"MessagesMain_input__R5zJ0",send:"MessagesMain_send__tKhge",textArea:"MessagesMain_textArea__v6811",messages:"MessagesMain_messages__eWIbA",empty:"MessagesMain_empty__Un+PR",messagesMe:"MessagesMain_messagesMe__Go3UK",messagesFriend:"MessagesMain_messagesFriend__4kSKR",messageContainerMe:"MessagesMain_messageContainerMe__GIXeF",messageContainerFriend:"MessagesMain_messageContainerFriend__6diH7",dateMe:"MessagesMain_dateMe__XY83U",dateFriend:"MessagesMain_dateFriend__Iu9Pj",dateMessages:"MessagesMain_dateMessages__HlrtQ",deletedInput:"MessagesMain_deletedInput__caMDW",back:"MessagesMain_back__-Z3YD",photoSender:"MessagesMain_photoSender__ZMI70",imgSenderBlock:"MessagesMain_imgSenderBlock__ZJrLC",infoSender:"MessagesMain_infoSender__9F9Tj",desactiveName:"MessagesMain_desactiveName__KMp2g",nameSender:"MessagesMain_nameSender__1ewyf",nameSenderText:"MessagesMain_nameSenderText__-gZpe",editIcon:"MessagesMain_editIcon__8-EL3",deleteMess:"MessagesMain_deleteMess__VEY-a"},o=t(1694),u=t.n(o),g=t(9434),l=t(2791),f=t(4942),m=t(9062);var h=t.p+"static/media/send.e6e41f470c70eedfe79bcc21222a7720.svg";var p=t.p+"static/media/done-contact.96f5b1f550c1b8a0775fd1a00afe598b.svg",x=t(3249),M=t(1413),v={modal:!1,editMess:{},editText:""};function _(e,s){switch(s.type){case"modal":return(0,M.Z)((0,M.Z)({},e),{},{modal:s.payload});case"editMess":return(0,M.Z)((0,M.Z)({},e),{},{editMess:s.payload});case"editText":return(0,M.Z)((0,M.Z)({},e),{},{editText:s.payload});case"init":return function(e){return(0,M.Z)({},e)}(s.payload)}}var w=t.p+"static/media/delete-white.775e9dd618f07a57d467dfc4059b0335.svg",Z=t(4778),I=t(4229);function y(e,s,t,n,a,r,i){return b.apply(this,arguments)}function b(){return b=(0,a.Z)((0,n.Z)().mark((function e(s,t,r,i,d,c,o){var u,g,l,h,p;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,m.QT)((0,m.JU)(s,"chats",t));case 2:if(!(u=e.sent).exists()){e.next=8;break}return g=u.data().messages,l=g.map((function(e){return e.id===i?(d((0,x.Hd)({chatId:t,messageId:i,messageText:c})),(0,M.Z)((0,M.Z)({},e),{},{messageText:c})):e})),e.next=8,(0,m.r7)((0,m.JU)(s,"chats",t),{messages:l});case 8:if(!r.users){e.next=13;break}Object.entries(r.users).map(function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t){var a,i;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!1!==t[1].deleted){e.next=6;break}return e.next=3,(0,m.r7)((0,m.JU)(s,"chatsList",t[0]),(0,f.Z)({},"".concat(r.id,".lastMessage.messageText"),c));case 3:a=c,i=r.id,d((0,Z.jY)({combinedId:i,lastMessages:a}));case 6:case"end":return e.stop()}}),e)})));return function(s){return e.apply(this,arguments)}}()),e.next=20;break;case 13:return e.next=15,(0,m.r7)((0,m.JU)(s,"chatsList",r.friendId),(0,f.Z)({},"".concat(r.id,".lastMessage.messageText"),c));case 15:return e.next=17,(0,m.r7)((0,m.JU)(s,"chatsList",o.id),(0,f.Z)({},"".concat(r.id,".lastMessage.messageText"),c));case 17:h=c,p=r.id,d((0,I.vh)({combinedId:p,lastMessages:h}));case 20:case"end":return e.stop()}}),e)}))),b.apply(this,arguments)}function j(e,s,t,n,a,r,i){return k.apply(this,arguments)}function k(){return k=(0,a.Z)((0,n.Z)().mark((function e(s,t,r,i,d,c,o){var u,g,l,h,p,x,M;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,m.QT)((0,m.JU)(r,"chats",s));case 2:if(!(u=e.sent).exists()){e.next=9;break}return g=u.data().messages,l=g.findIndex((function(e){return e.id===t})),g.splice(l,1),e.next=9,(0,m.r7)((0,m.JU)(r,"chats",s),{messages:g});case 9:if(h=c.find((function(e){return e.chatId===d.id})),p=h.messages.length>=2?h.messages[h.messages.length-2].text:"No messages",h.messages[h.messages.length-1].messageId!==t){e.next=24;break}if(!d.users){e.next=17;break}Object.entries(d.users).map(function(){var e=(0,a.Z)((0,n.Z)().mark((function e(s){var t,a;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!1!==s[1].deleted){e.next=6;break}return e.next=3,(0,m.r7)((0,m.JU)(r,"chatsList",s[0]),(0,f.Z)({},"".concat(d.id,".lastMessage.messageText"),p));case 3:t=p,a=d.id,i((0,Z.jY)({combinedId:a,lastMessages:t}));case 6:case"end":return e.stop()}}),e)})));return function(s){return e.apply(this,arguments)}}()),e.next=24;break;case 17:return e.next=19,(0,m.r7)((0,m.JU)(r,"chatsList",d.friendId),(0,f.Z)({},"".concat(d.id,".lastMessage.messageText"),p));case 19:return e.next=21,(0,m.r7)((0,m.JU)(r,"chatsList",o.id),(0,f.Z)({},"".concat(d.id,".lastMessage.messageText"),p));case 21:x=p,M=d.id,i((0,I.vh)({combinedId:M,lastMessages:x}));case 24:case"end":return e.stop()}}),e)}))),k.apply(this,arguments)}var S=t(184);function T(e){var s=e.stateEditMess,t=e.setSizeWindow,r=e.sendMess,i=e.text,d=e.setMessageText,o=e.handleEvent,M=e.innerRef,_=e.infoChat,Z=(0,g.v9)((function(e){return e.user})),I=(0,g.v9)((function(e){return e.message.messages})),b=(0,m.ad)(),k=(0,l.useRef)(),T=(0,g.I0)();(0,l.useEffect)((function(){function e(){var e=window.visualViewport.height;t(e)}return window.addEventListener("resize",e),function(){e()}}),[]);var N=function(){var e=(0,a.Z)((0,n.Z)().mark((function e(){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,m.r7)((0,m.JU)(b,"chatsList",Z.id),(0,f.Z)({},"".concat(_.id,".viewMessage.newMessView"),!0));case 3:if(!_.users){e.next=8;break}Object.entries(_.users).map(function(){var e=(0,a.Z)((0,n.Z)().mark((function e(s){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!1!==s[1].deleted||s[0]===Z.id){e.next=3;break}return e.next=3,(0,m.r7)((0,m.JU)(b,"chatsList",s[0]),(0,f.Z)({},"".concat(_.id,".viewMessage.viewMess"),!0));case 3:case"end":return e.stop()}}),e)})));return function(s){return e.apply(this,arguments)}}()),e.next=10;break;case 8:return e.next=10,(0,m.r7)((0,m.JU)(b,"chatsList",_.friendId),(0,f.Z)({},"".concat(_.id,".viewMessage.viewMess"),!0));case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),console.error(e.t0);case 15:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(){return e.apply(this,arguments)}}();(0,l.useEffect)((function(){var e=k.current;e&&e.focus()}),[s[0].modal]);var U=function(){var e=(0,a.Z)((0,n.Z)().mark((function e(){var t,a,r;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=s[0].editText,a=_.id,r=s[0].editMess.messageId,_.lastMessages===t||""===t.trim()||y(b,a,_,r,T,t,Z),s[1]({type:"init",payload:v});case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),E=function(){var e=(0,a.Z)((0,n.Z)().mark((function e(){var t,a,r;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=_.id,a=s[0].editMess.messageId,r=Z.id,T((0,x._A)({chatId:t,messageId:a,userId:r})),j(t,a,b,T,_,I,Z),s[1]({type:"init",payload:v});case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,S.jsx)("section",{className:c.textArea,ref:M,children:s[0].modal?(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("textarea",{onChange:function(e){return s[1]({type:"editText",payload:e.target.value})},ref:k,value:s[0].editText,onKeyDown:o,name:"messages",id:"textareaEdit",type:"text",className:c.input,rows:"1"}),(0,S.jsx)("button",{onClick:function(){return E()},className:u()(c.send,c.deleteMess),children:(0,S.jsx)("img",{src:w,alt:"delete message"})}),(0,S.jsx)("button",{onClick:function(){return U()},className:c.send,children:(0,S.jsx)("img",{src:p,alt:"accept"})})]}):(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("textarea",{onClick:function(){return N()},placeholder:"Enter your message",onKeyDown:o,value:i,onChange:function(e){return d(e.target.value)},name:"messages",id:"textarea",type:"text",className:c.input,rows:"1"}),(0,S.jsx)("button",{onClick:function(){return r()},type:"submit",className:c.send,children:(0,S.jsx)("img",{src:h,alt:"Send"})})]})})}var N=t(3825),U=t(4244),E=t(9594);function J(e){var s=e.setSizeWindow,t=e.infoChat,n=e.scrollRef,a=e.stateEditMess,r=(0,g.v9)((function(e){return e.message.messages})),i=(0,g.v9)((function(e){return e.user})),d=r.find((function(e){return e.chatId===t.id})),o=(0,m.ad)(),f=(0,g.I0)(),h=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];(0,l.useEffect)((function(){n.current.scrollTop=n.current.scrollHeight}),[r]),(0,l.useEffect)((function(){return window.addEventListener("onload",s(window.visualViewport.height)),function(){return window.addEventListener("resize",s(window.visualViewport.height))}}),[r,window.innerHeight]),(0,l.useEffect)((function(){var e=(0,m.cf)((0,m.JU)(o,"chats",t.id),(function(e){if(!e.data())return!1;var s=e.data(),n=t.id;if(d&&d.messages&&s.messages.length<d.messages.length)for(var a=0;a<d.messages.length;a++)if(void 0===s.messages[a]||s.messages.length<d.messages.length){var r=d.messages[a].messageId;f((0,x._A)({chatId:n,messageId:r}))}s.messages.map((function(e){var s=e.userId,t=e.messageText,a=e.id,r=e.date,i=e.photo,c=e.name,o=h[r.toDate().getDay()],u=r.toDate().getHours(),g=r.toDate().getMinutes().toString();1===g.length&&(g="0".concat(g));var l="".concat(o," ").concat(u,":").concat(g);if(d&&d.messages){var m=d.messages.find((function(e){return e.messageId===a}));void 0!==m&&void 0!==m.photo&&void 0!==i&&m.photo!==i&&f((0,x.xK)({messageId:a,chatId:n,photo:i})),void 0!==m&&void 0!==m.name&&void 0!==c&&m.name!==c&&f((0,x.y1)({messageId:a,chatId:n,name:c})),void 0!==m&&void 0!==t&&void 0!==m.text&&m.text!==t&&f((0,x.Hd)({chatId:n,messageId:a,messageText:t}))}f((0,x.Hz)({name:c,chatId:n,userId:s,messageText:t,datePush:l,messageId:a,photo:i}))}))}));return function(){e()}}),[d]);return r.length>0&&d&&d.messages.length>0?d.messages.map((function(e){return e.userId===i.id?(0,S.jsxs)("div",{className:c.messageContainerMe,children:[(0,S.jsxs)("span",{onClick:function(){!function(e,s){var t=e,n=s.messages.find((function(e){return e.messageId===t}));n&&(a[1]({type:"modal",payload:!0}),a[1]({type:"editMess",payload:n}),a[1]({type:"editText",payload:n.text}))}(e.messageId,d)},className:u()("message",c.messagesMe),children:[(0,S.jsx)("span",{children:e.text}),(0,S.jsx)("span",{className:u()(c.dateMessages,c.dateMe),children:e.date})]}),(0,S.jsx)("span",{className:c.infoSender,children:(0,S.jsx)("span",{className:c.imgSenderBlock,children:(0,S.jsx)("img",{className:c.photoSender,src:e.photo?e.photo:N,alt:"Photo user"})})})]},e.messageId):(0,S.jsxs)("div",{className:c.messageContainerFriend,children:[(0,S.jsxs)("span",{className:c.infoSender,children:[(0,S.jsx)("span",{className:c.imgSenderBlock}),(0,S.jsx)("img",{className:c.photoSender,src:e.photo?e.photo:N,alt:"Photo user"})]}),(0,S.jsxs)("span",{className:u()("message",c.messagesFriend),children:[(0,S.jsx)("span",{children:e.text}),(0,S.jsx)("span",{className:u()(c.dateMessages,c.dateFriend),children:e.date})]})]},e.messageId)})):(0,S.jsx)(E.H,{text:"No Messages"})}var C=t(9232),L=t(8552),F=t(4261);function R(e,s,t,n){return H.apply(this,arguments)}function H(){return(H=(0,a.Z)((0,n.Z)().mark((function e(s,t,a,r){var i,d,c,o,u,g;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d=(0,F.Z)(),c=m.EK.now(),e.next=4,(0,m.r7)((0,m.JU)(s,"chats",t.id),{messages:(0,m.vr)({id:d,messageText:a,userId:r.id,date:c,photo:r.photo,name:r.name,deleted:!1})});case 4:return e.next=6,(0,m.r7)((0,m.JU)(s,"chatsList",r.id),(i={},(0,f.Z)(i,t.id+".lastMessage",{messageText:a}),(0,f.Z)(i,t.id+".date",(0,m.Bt)()),(0,f.Z)(i,t.id+".viewMessage",{newMessView:!0,idSender:r.id,viewMess:!1}),i));case 6:if(!t.users){e.next=20;break}e.t0=(0,n.Z)().keys(t.users);case 8:if((e.t1=e.t0()).done){e.next=18;break}return o=e.t1.value,e.next=12,(0,m.QT)((0,m.JU)(s,"chatsList",o));case 12:if(!e.sent.exists()){e.next=16;break}return e.next=16,(0,m.r7)((0,m.JU)(s,"chatsList",o),(u={},(0,f.Z)(u,t.id+".lastMessage",{messageText:a}),(0,f.Z)(u,t.id+".date",(0,m.Bt)()),(0,f.Z)(u,t.id+".viewMessage",{newMessView:!1,idSender:r.id,viewMess:!1}),u));case 16:e.next=8;break;case 18:e.next=26;break;case 20:return e.next=22,(0,m.QT)((0,m.JU)(s,"chatsList",t.friendId));case 22:if(!e.sent.exists()){e.next=26;break}return e.next=26,(0,m.r7)((0,m.JU)(s,"chatsList",t.friendId),(g={},(0,f.Z)(g,t.id+".lastMessage",{messageText:a}),(0,f.Z)(g,t.id+".date",(0,m.Bt)()),(0,f.Z)(g,t.id+".viewMessage",{newMessView:!1,idSender:r.id,viewMess:!1}),g));case 26:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function D(){var e=(0,g.v9)((function(e){return e.friend.friend})),s=(0,g.v9)((function(e){return e.group.group})),t=(0,g.v9)((function(e){return e.user})),o=(0,i.s0)(),f=(0,l.useRef)(),h=(0,l.useRef)(),p=(0,l.useRef)(),x=(0,m.ad)(),M=Object.values((0,i.UO)()),w=(0,r.Z)(M,1)[0],y=e.find((function(e){return e.id===w}))?e.find((function(e){return e.id===w})):s.find((function(e){return e.id===w})),b=(0,g.I0)(),j=(0,l.useReducer)(C.Yj,C.m5),k=(0,r.Z)(j,2),E=k[0],F=k[1],H=(0,l.useReducer)(_,v),D=(0,r.Z)(H,2),V=D[0],K=D[1],A=(0,l.useState)(window.visualViewport.height),z=(0,r.Z)(A,2),B=z[0],O=z[1],W=(0,l.useState)(!1),Y=(0,r.Z)(W,2),Q=Y[0],P=Y[1],X=(0,l.useState)(""),G=(0,r.Z)(X,2),q=G[0],$=G[1],ee=function(){var e=(0,a.Z)((0,n.Z)().mark((function e(){var s;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s=q,$(""),""!==s&&R(x,y,s,t);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,l.useEffect)((function(){var e=(0,m.cf)((0,m.JU)(x,"chatsList",t.id),(function(e){var s=!!e.data()&&Object.entries(e.data());if(s){var n=s.find((function(e){return e[0]===y.id})),a=n&&n[1].viewMessage,r=a&&a.viewMess,i=a&&a.idSender,d=a&&a.newMessView;if(n&&n[1].chat){var c=n[0],o=n[1].name?n[1].name.name:"",u=n[1].photo.photo;if(n[1].deleted.deleted)return b((0,I.aE)({name:o,photo:u,combinedId:c})),void P(!0);b((0,I.aE)({name:o,photo:u,combinedId:c})),P(!1),b((0,I.XC)({newMess:d,view:r,combinedId:c,idSender:i}))}else if(n&&n[1].group){for(var g=n[0],l=Object.entries(n[1].group.users),f=n[1].group.users,m=Object.entries(y.users),h=0;h<l.length;h++)l[h][1].deleted!==m[h][1].deleted&&b((0,Z.ei)({combinedId:g,users:f})),l[h][1].admin&&l[h][1].id===t.id&&F({type:"admin",payload:!0});b((0,Z._U)({newMess:d,view:r,combinedId:g,idSender:i}))}}}));return function(){e()}}),[y]),(0,l.useEffect)((function(){if(null!==h.current){var e=f.current.offsetHeight,s=p.current.offsetHeight,t=window.visualViewport.height-(e+s);h.current.style.height="".concat(t,"px"),h.current.scrollTop=h.current.scrollHeight}}),[B]),(0,S.jsx)("section",{className:c.messagesSec,children:(0,S.jsxs)("div",{className:u()(c.container,"container"),children:[(0,S.jsxs)("header",{className:c.header,ref:f,children:[(0,S.jsxs)("div",{className:c.user,children:[E.admin&&(0,S.jsx)(d.rU,{state:y,to:"/edit-group",children:(0,S.jsx)("img",{className:c.editIcon,src:L.Z,alt:"edit"})}),(0,S.jsx)("div",{className:c.userImg,children:(0,S.jsx)("img",{src:null!==y.photo?y.photo:N,alt:"User"})}),(0,S.jsx)("div",{className:c.about,children:(0,S.jsx)("h2",{className:c.name,children:y.name})})]}),(0,S.jsx)("div",{onClick:function(){o("/")},className:c.back,children:(0,S.jsx)("img",{src:U.Z,alt:"back"})})]}),(0,S.jsx)("section",{ref:h,id:"scroll",className:V.modal?u()(c.noScroll,c.messages):c.messages,children:(0,S.jsx)(J,{stateEditMess:[V,K],setSizeWindow:O,scrollRef:h,infoChat:y})}),Q?(0,S.jsx)("div",{ref:p,className:u()(c.deletedInput),children:"Account has been deleted"}):(0,S.jsx)(T,{stateEditMess:[V,K],infoChat:y,scrollRef:h,setSizeWindow:O,innerRef:p,handleEvent:function(e){"Enter"===e.code&&!1===e.ctrlKey&&!1===e.shiftKey&&(e.preventDefault(),ee())},sendMess:ee,text:q,setMessageText:$})]})})}}}]);
//# sourceMappingURL=632.c082158f.chunk.js.map