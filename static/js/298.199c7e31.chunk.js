"use strict";(self.webpackChunkmy_app=self.webpackChunkmy_app||[]).push([[298],{4244:function(e,s,n){n(2791);s.Z=n.p+"static/media/back-dark.0645de5e8c6159eb4cd2606e1c4042ec.svg"},9298:function(e,s,n){n.r(s),n.d(s,{default:function(){return k}});var t=n(4165),a=n(4942),r=n(5861),i=n(885),d=n(7689),c={header:"MessagesMain_header__EMkYa",user:"MessagesMain_user__TDMJA",userImg:"MessagesMain_userImg__Mop0A",name:"MessagesMain_name__58IH7",online:"MessagesMain_online__FByeQ",dots:"MessagesMain_dots__9N9pU",container:"MessagesMain_container__c2E6N",input:"MessagesMain_input__R5zJ0",send:"MessagesMain_send__tKhge",textArea:"MessagesMain_textArea__v6811",messages:"MessagesMain_messages__eWIbA",empty:"MessagesMain_empty__Un+PR",messagesMe:"MessagesMain_messagesMe__Go3UK",messagesFriend:"MessagesMain_messagesFriend__4kSKR",messageContainerMe:"MessagesMain_messageContainerMe__GIXeF",messageContainerFriend:"MessagesMain_messageContainerFriend__6diH7",dateMe:"MessagesMain_dateMe__XY83U",dateFriend:"MessagesMain_dateFriend__Iu9Pj",dateMessages:"MessagesMain_dateMessages__HlrtQ",deletedInput:"MessagesMain_deletedInput__caMDW",back:"MessagesMain_back__-Z3YD"},o=n(1694),u=n.n(o),f=n(9434),l=n(2791),g=n(9062);var m=n.p+"static/media/send.e6e41f470c70eedfe79bcc21222a7720.svg",h=n(184);function v(e){var s=e.setSizeWindow,n=e.sendMess,i=e.text,d=e.setMessageText,o=e.handleEvent,u=e.innerRef,v=e.infoChat,M=(0,f.v9)((function(e){return e.user})),p=(0,g.ad)();(0,l.useEffect)((function(){function e(){var e=window.visualViewport.height;s(e)}return window.addEventListener("resize",e),function(){e()}}),[]);var w=function(){var e=(0,r.Z)((0,t.Z)().mark((function e(){return(0,t.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,g.r7)((0,g.JU)(p,"chatsList",M.id),(0,a.Z)({},v.id+".viewNewMessage",{viewNewMess:!0}));case 3:return e.next=5,(0,g.r7)((0,g.JU)(p,"chatsList",v.friendId),(0,a.Z)({},v.id+".viewMessage",{view:!0}));case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.error(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}();return(0,h.jsxs)("section",{className:c.textArea,ref:u,children:[(0,h.jsx)("textarea",{onClick:function(){return w()},placeholder:"Enter your message",onKeyDown:o,value:i,onChange:function(e){return d(e.target.value)},name:"messages",id:"textarea",type:"text",className:c.input,rows:"1"}),(0,h.jsx)("button",{onClick:function(){return n()},type:"submit",className:c.send,children:(0,h.jsx)("img",{src:m,alt:"Send"})})]})}var M=n(3249);function p(e){var s=e.setSizeWindow,n=e.infoChat,t=e.scrollRef,a=(0,f.v9)((function(e){return e.message.messages})),r=(0,f.v9)((function(e){return e.user})),i=a.find((function(e){return e.chatId===n.id})),d=(0,g.ad)(),o=(0,f.I0)(),m=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];return(0,l.useEffect)((function(){t.current.scrollTop=t.current.scrollHeight}),[a]),(0,l.useEffect)((function(){return window.addEventListener("onload",s(window.visualViewport.height)),function(){return window.addEventListener("resize",s(window.visualViewport.height))}}),[a,window.innerHeight]),(0,l.useEffect)((function(){var e=(0,g.cf)((0,g.JU)(d,"chats",n.id),(function(e){if(!e.data())return!1;var s=e.data(),t=n.id;s.messages.map((function(e){var s=e.userId,n=e.messageText,a=e.id,r=e.date,i=m[r.toDate().getDay()],d=r.toDate().getHours(),c=r.toDate().getMinutes().toString();1===c.length&&(c="0".concat(c));var u="".concat(i," ").concat(d,":").concat(c);o((0,M.Hz)({chatId:t,userId:s,messageText:n,datePush:u,messageId:a}))}))}));return function(){e()}}),[n.id]),a.length>0&&i?i.messages.map((function(e){return e.userId===r.id?(0,h.jsx)("div",{className:c.messageContainerMe,children:(0,h.jsxs)("span",{className:u()("message",c.messagesMe),children:[e.text,(0,h.jsx)("span",{className:u()(c.dateMessages,c.dateMe),children:e.date})]})},e.messageId):(0,h.jsx)("div",{className:c.messageContainerFriend,children:(0,h.jsxs)("span",{className:u()("message",c.messagesFriend),children:[e.text,(0,h.jsx)("span",{className:u()(c.dateMessages,c.dateFriend),children:e.date})]})},e.messageId)})):(0,h.jsx)("div",{className:u()(c.empty),children:"No Messages"})}var w,_={randomUUID:"undefined"!==typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)},x=new Uint8Array(16);function y(){if(!w&&!(w="undefined"!==typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return w(x)}for(var I=[],N=0;N<256;++N)I.push((N+256).toString(16).slice(1));function j(e){var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(I[e[s+0]]+I[e[s+1]]+I[e[s+2]]+I[e[s+3]]+"-"+I[e[s+4]]+I[e[s+5]]+"-"+I[e[s+6]]+I[e[s+7]]+"-"+I[e[s+8]]+I[e[s+9]]+"-"+I[e[s+10]]+I[e[s+11]]+I[e[s+12]]+I[e[s+13]]+I[e[s+14]]+I[e[s+15]]).toLowerCase()}var U=function(e,s,n){if(_.randomUUID&&!s&&!e)return _.randomUUID();var t=(e=e||{}).random||(e.rng||y)();if(t[6]=15&t[6]|64,t[8]=63&t[8]|128,s){n=n||0;for(var a=0;a<16;++a)s[n+a]=t[a];return s}return j(t)},Z=n(3825),b=n(4229),S=n(4244);function k(){var e=(0,f.v9)((function(e){return e.friend.friend})),s=(0,f.v9)((function(e){return e.user})),n=(0,d.s0)(),o=(0,l.useRef)(),m=(0,l.useRef)(),M=(0,l.useRef)(),w=(0,g.ad)(),_=Object.values((0,d.UO)()),x=(0,i.Z)(_,1)[0],y=e.find((function(e){return e.id===x})),I=(0,f.I0)(),N=(0,l.useState)(window.visualViewport.height),j=(0,i.Z)(N,2),k=j[0],E=j[1],C=(0,l.useState)(!1),D=(0,i.Z)(C,2),R=D[0],T=D[1],F=(0,l.useState)(""),H=(0,i.Z)(F,2),J=H[0],L=H[1],z=function(){var e=(0,r.Z)((0,t.Z)().mark((function e(){var n,r,i,d,c;return(0,t.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=J,L(""),""===n){e.next=15;break}return i=U(),d=g.EK.now(),e.next=7,(0,g.r7)((0,g.JU)(w,"chats",y.id),{messages:(0,g.vr)({id:i,messageText:n,userId:s.id,date:d})});case 7:return e.next=9,(0,g.r7)((0,g.JU)(w,"chatsList",s.id),(r={},(0,a.Z)(r,y.id+".lastMessage",{messageText:n}),(0,a.Z)(r,y.id+".date",(0,g.Bt)()),(0,a.Z)(r,y.id+".viewMessage",{view:!1}),(0,a.Z)(r,y.id+".idSender",{idSender:s.id}),(0,a.Z)(r,y.id+".viewNewMessage",{viewNewMess:!0}),r));case 9:return e.next=11,(0,g.QT)((0,g.JU)(w,"chatsList",y.friendId));case 11:if(!e.sent.exists()){e.next=15;break}return e.next=15,(0,g.r7)((0,g.JU)(w,"chatsList",y.friendId),(c={},(0,a.Z)(c,y.id+".lastMessage",{messageText:n}),(0,a.Z)(c,y.id+".date",(0,g.Bt)()),(0,a.Z)(c,y.id+".viewMessage",{view:!1}),(0,a.Z)(c,y.id+".idSender",{idSender:s.id}),(0,a.Z)(c,y.id+".viewNewMessage",{viewNewMess:!1}),c));case 15:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,l.useEffect)((function(){var e=(0,g.cf)((0,g.JU)(w,"chatsList",s.id),(function(e){var s=Object.entries(e.data());if(s){var n=s.find((function(e){return e[0]===y.id}));if(n){var t=n[0],a=y.id,r=n[1].userInfo.displayName?n[1].userInfo.displayName:"",i=n[1].userInfo.photo,d=n[1].viewMessage.view,c=n[1].idSender?n[1].idSender.idSender:null,o=n[1].viewNewMessage.viewNewMess;if("deleted"===n[1].userInfo.acc)return I((0,b.aE)({name:r,photo:i,friendInfo:a})),void T(!0);I((0,b.aE)({name:r,photo:i,friendInfo:a})),T(!1),I((0,b.XC)({newMess:o,view:d,combinedId:t,idSender:c}))}}}));return function(){e()}}),[e.name,e.photo,e.email]),(0,l.useEffect)((function(){if(null!==m.current){var e=o.current.offsetHeight,s=M.current.offsetHeight,n=window.visualViewport.height-(e+s);m.current.style.height="".concat(n,"px"),m.current.scrollTop=m.current.scrollHeight}}),[k]),(0,h.jsx)("section",{className:c.messagesSec,children:(0,h.jsxs)("div",{className:u()(c.container,"container"),children:[(0,h.jsxs)("header",{className:c.header,ref:o,children:[(0,h.jsxs)("div",{className:c.user,children:[(0,h.jsx)("div",{className:c.userImg,children:(0,h.jsx)("img",{src:null!==y.photo?y.photo:Z,alt:"User"})}),(0,h.jsx)("div",{className:c.about,children:(0,h.jsx)("h2",{className:c.name,children:y.name})})]}),(0,h.jsx)("div",{onClick:function(){n("/")},className:c.back,children:(0,h.jsx)("img",{src:S.Z,alt:"back"})})]}),(0,h.jsx)("section",{ref:m,id:"scroll",className:c.messages,children:(0,h.jsx)(p,{setSizeWindow:E,scrollRef:m,infoChat:y})}),R?(0,h.jsx)("div",{ref:M,className:u()(c.deletedInput),children:"Account has been deleted"}):(0,h.jsx)(v,{infoChat:y,scrollRef:m,setSizeWindow:E,innerRef:M,handleEvent:function(e){"Enter"===e.code&&!1===e.ctrlKey&&!1===e.shiftKey&&(e.preventDefault(),z())},sendMess:z,text:J,setMessageText:L})]})})}}}]);
//# sourceMappingURL=298.199c7e31.chunk.js.map