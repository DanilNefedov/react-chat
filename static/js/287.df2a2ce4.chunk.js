"use strict";(self.webpackChunkmy_app=self.webpackChunkmy_app||[]).push([[287],{1287:function(e,t,n){n.r(t),n.d(t,{default:function(){return M}});var r=n(2982),a=n(885),s="Friends_head__z9KAn",c="Friends_header__2vtis",i="Friends_friends__RuUv0",o="Friends_container__Ji6-h",d="Friends_searchFriends__o9ewN",u="Friends_containerFriendsList__ZbZT9",l="Friends_scrollMessages__a2NvB",f="Friends_emptyBlock__ZwYFc",h=n(1694),m=n.n(h),p=n(9434),v=n(4942),_=n(4165),x=n(5861),g=n(8516),y=n(1059),j=n(4229),Z=n(9062),b=n(2791),w=n(7689),N=n(2010),I=n(2789),S=n(4426),L=n(184),R=b.lazy((function(){return n.e(291).then(n.bind(n,3291))}));function F(e){var t=e.text,n=e.setText,r=e.searchListRef,s=e.searchRef,c=(0,b.useReducer)(S.ro,S.fI),i=(0,a.Z)(c,2),o=i[0],d=i[1],u=(0,p.I0)(),l=(0,Z.ad)(),f=(0,p.v9)((function(e){return e.friend.friend})),h=(0,p.v9)((function(e){return e.user})),F=(0,b.useState)([]),k=(0,a.Z)(F,2),M=k[0],E=k[1],P=function(){var e=(0,x.Z)((0,_.Z)().mark((function e(){var n,r,a;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(0,Z.IO)((0,Z.hJ)(l,"users"),(0,Z.ar)("name","==",t)),e.prev=1,e.next=4,(0,Z.PL)(n);case 4:r=e.sent,a=[],E([]),r.forEach((function(e){var t=e.data();t.id!==h.id&&(d({type:"resetModal",payload:S.fI}),a.push(t),E(a))})),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(1),d({type:"activeModalWindow",payload:!0}),console.error(e.t0);case 14:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(){return e.apply(this,arguments)}}(),T=function(){var e=(0,x.Z)((0,_.Z)().mark((function e(t){var n,r,a,s,c,i,o,m;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.name,r=t.id,a=t.photoURL,s=h.id>r?h.id+r:r+h.id,c=f.find((function(e){return e.id===s})),e.prev=5,c||(i=r,u((0,j.d8)({combinedId:s,name:n,friendId:i,photo:a}))),e.next=9,(0,Z.QT)((0,Z.JU)(l,"chats",s));case 9:if(e.sent.exists()){e.next=17;break}return e.next=13,(0,Z.pl)((0,Z.JU)(l,"chats",s),{messages:[]});case 13:return e.next=15,(0,Z.r7)((0,Z.JU)(l,"chatsList",h.id),(o={},(0,v.Z)(o,s+".userInfo",{id:r,displayName:n,photo:a}),(0,v.Z)(o,s+".date",(0,Z.Bt)()),o));case 15:return e.next=17,(0,Z.r7)((0,Z.JU)(l,"chatsList",r),(m={},(0,v.Z)(m,s+".userInfo",{id:h.id,displayName:h.name,photo:h.photo}),(0,v.Z)(m,s+".date",(0,Z.Bt)()),m));case 17:d({type:"resetModal",payload:S.fI}),e.next=24;break;case 20:e.prev=20,e.t0=e.catch(5),d({type:"activeModalWindow",payload:!0}),console.error(e.t0);case 24:case"end":return e.stop()}}),e,null,[[5,20]])})));return function(t){return e.apply(this,arguments)}}(),H=(0,w.bx)(),J=(0,b.useRef)();function U(){if(null!==J.current&&void 0!==J.current){var e=s.current.offsetHeight,t=H.navRef.current.offsetHeight,n=window.innerHeight-(e+t);J.current.style.height="".concat(n,"px")}}return(0,b.useEffect)((function(){return U(),window.addEventListener("onload",U),function(){return window.addEventListener("resize",U)}}),[M]),(0,L.jsxs)("div",{className:m()(y.Z.container,"container"),children:[(0,L.jsx)("section",{ref:s,className:y.Z.search,id:"search",children:(0,L.jsxs)("div",{className:y.Z.cont,children:[(0,L.jsx)("input",{inputMode:"search",className:m()(y.Z.searchIcon),onKeyUp:function(e){return function(e){e.preventDefault(),13===e.keyCode&&(P(),n(""))}(e)},value:t,onChange:function(e){return n(e.target.value)},type:"search",id:y.Z.searchIcon,placeholder:"Find friend"}),(0,L.jsx)("button",{type:"submit",onClick:function(e){e.preventDefault(),n(""),P()},className:y.Z.loupe,htmlFor:"search-icon",children:(0,L.jsx)("img",{src:g.Z,alt:"Search"})})]})}),(0,L.jsx)("section",{ref:r,className:y.Z.searchList,id:"search-list",children:0===M.length?(0,L.jsx)("div",{className:y.Z.empty,children:"Search list is empty"}):(0,L.jsx)("div",{ref:J,className:m()(y.Z.containerSearchList,"container-search-list"),children:(0,L.jsx)(b.Suspense,{fallback:(0,L.jsx)(I.a,{}),children:(0,L.jsx)(R,{user:M,clickChat:T})})})}),o.activeModalWindow?(0,L.jsx)(N.T,{state:[o,d]}):(0,L.jsx)(L.Fragment,{})]})}var k=b.lazy((function(){return n.e(690).then(n.bind(n,7787))}));function M(){var e=(0,w.bx)(),t=(0,b.useRef)(),n=(0,b.useRef)(),h=(0,b.useState)(""),v=(0,a.Z)(h,2),_=v[0],x=v[1],g=(0,b.useReducer)(S.ro,S.fI),y=(0,a.Z)(g,2),R=y[0],M=y[1],E=(0,p.v9)((function(e){return e.user})),P=(0,Z.ad)(),T=(0,p.I0)(),H=(0,p.v9)((function(e){return e.friend.friend})),J=(0,r.Z)(H),U=(0,b.useRef)(),W=(0,b.useRef)(),B=(0,b.useRef)(),D=(0,b.useRef)(null),z=e.modal,C=e.setModal;function K(){if(null!==t.current){var n=t.current.offsetHeight,r=U.current.offsetHeight,a=e.navRef.current.offsetHeight,s=n- -(window.innerHeight-(n+r+a));t.current.style.height="".concat(s,"px")}}return(0,b.useEffect)((function(){var e=(0,Z.cf)((0,Z.JU)(P,"chatsList",E.id),(function(e){e.data()?(Object.entries(e.data()).map((function(e){var t=e[0];if(t){var n=e[1].userInfo,r=e[1].date.toDate(),a=n.id,s=n.displayName,c=n.photo,i=e[1].lastMessage?e[1].lastMessage.messageText:"No messages",o=r.getTime()?r.getTime():"--:--",d=new Date,u="".concat(r.getDate(),".").concat(r.getMonth()+1,".").concat(r.getFullYear()),l="".concat(d.getDate(),".").concat(d.getMonth()+1,".").concat(d.getFullYear()),f=r.getMinutes().toString();1===f.length&&(f="0".concat(f));var h=H.find((function(e){return e.id===t}));if(u===l){var m="".concat(r.getHours(),":").concat(f);if(h){if(h.timePublic!==o){var p=t,v=i,_=m;T((0,j.Bx)({friendInfo:p,messageText:v,datePush:_,timePublic:o}))}else if(h.name!==s||h.photo!==c){var x=t;T((0,j.aE)({friendInfo:x,photo:c,name:s}))}}else T((0,j.d8)({combinedId:t,name:s,date:m,friendId:a,timePublic:o,lastMessages:i,photo:c}))}else{var g=u;if(h){if(h.timePublic!==o){var y=t,Z=i,b=g;T((0,j.Bx)({friendInfo:y,messageText:Z,datePush:b,timePublic:o}))}else if(h.name!==s||h.photo!==c){var w=t;T((0,j.aE)({friendInfo:w,photo:c,name:s}))}}else T((0,j.d8)({combinedId:t,name:s,date:g,friendId:a,timePublic:o,lastMessages:i,photo:c}))}}})),M({type:"resetModal",payload:S.fI})):M({type:"activeModalWindow",payload:!0})}));return function(){e()}}),[H]),(0,b.useEffect)((function(){return window.addEventListener("onload",K),K(),function(){return window.addEventListener("resize",K)}}),[H]),(0,b.useEffect)((function(){var t=D.current,n=e.searchRef.current,r=function(e){t.contains(e.target)||n.contains(e.target)||C(!1)};return z||document.addEventListener("click",r),function(){return document.removeEventListener("click",r)}}),[]),(0,L.jsxs)("section",{className:"home",children:[(0,L.jsx)("div",{ref:D,className:z?m()(d,"search-friends, active-modal-search"):m()(d,"search-friends"),children:(0,L.jsx)(F,{searchListRef:B,searchRef:W,text:_,setText:x})}),(0,L.jsx)("section",{className:i,ref:n,children:(0,L.jsxs)("div",{className:m()(o,"container"),children:[(0,L.jsx)("div",{ref:U,className:m()(s,"head"),children:(0,L.jsx)("h2",{className:m()(c,"header"),children:"Friends"})}),(0,L.jsx)("div",{ref:t,className:l,children:(0,L.jsx)("div",{className:m()(u),children:(0,L.jsx)(b.Suspense,{fallback:(0,L.jsx)(I.a,{}),children:H.length>0?J.sort((function(e,t){return t.timePublic-e.timePublic})).map((function(e){return(0,L.jsx)(k,{friend:e},e.id)})):(0,L.jsx)("div",{className:m()(f),children:"Friend list is empty"})})})})]})}),R.activeModalWindow?(0,L.jsx)(N.T,{state:[R,M]}):(0,L.jsx)(L.Fragment,{})]})}},1059:function(e,t){t.Z={searchIcon:"Search_searchIcon__2+JeP",searchList:"Search_searchList__Amjcz",search:"Search_search__xXfoW",cont:"Search_cont__yR28o",loupe:"Search_loupe__ab9N9","list-content":"Search_list-content__WxR1l",list:"Search_list__iolTq",user:"Search_user__bbvWu",name:"Search_name__uV342",searchListName:"Search_searchListName__4BQqk",container:"Search_container__DjhSj",containerSearchList:"Search_containerSearchList__v3e9K",empty:"Search_empty__RZhOd"}}}]);
//# sourceMappingURL=287.df2a2ce4.chunk.js.map