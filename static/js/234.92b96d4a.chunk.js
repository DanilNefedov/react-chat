"use strict";(self.webpackChunkmy_app=self.webpackChunkmy_app||[]).push([[234],{2234:function(e,n,t){t.r(n),t.d(n,{default:function(){return k}});var r=t(2982),s=t(885),a="Friends_head__z9KAn",c="Friends_header__2vtis",i="Friends_friends__RuUv0",o="Friends_container__Ji6-h",u="Friends_searchFriends__o9ewN",d="Friends_containerFriendsList__ZbZT9",f="Friends_scrollMessages__a2NvB",h="Friends_emptyBlock__ZwYFc",l=t(1694),m=t.n(l),_=t(9434),p=t(4942),v=t(4165),x=t(5861),g=t(8516),j=t(1059),Z=t(4229),b=t(9062),S=t(184);var N=t(2791),y=t(7689),L=t(865),w=t(2789),I=N.lazy((function(){return t.e(291).then(t.bind(t,3291))}));function F(e){var n=e.text,t=e.setText,r=e.searchListRef,a=e.searchRef,c=(0,N.useState)(!1),i=(0,s.Z)(c,2),o=i[0],u=i[1],d=(0,_.I0)(),f=(0,b.ad)(),h=(0,_.v9)((function(e){return e.friend.friend})),l=(0,_.v9)((function(e){return e.user})),F=(0,N.useState)(""),R=(0,s.Z)(F,2),k=R[0],E=R[1],M=(0,N.useState)([]),P=(0,s.Z)(M,2),T=P[0],H=P[1],J=function(){var e=(0,x.Z)((0,v.Z)().mark((function e(){var t,r,s;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=(0,b.IO)((0,b.hJ)(f,"users"),(0,b.ar)("name","==",n)),e.prev=1,e.next=4,(0,b.PL)(t);case 4:r=e.sent,s=[],H([]),r.forEach((function(e){var n=e.data();n.id!==l.id&&(u(!1),s.push(n),H(s))})),e.next=15;break;case 10:e.prev=10,e.t0=e.catch(1),u(!0),E(""),console.error(e.t0);case 15:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(){return e.apply(this,arguments)}}(),U=function(){var e=(0,x.Z)((0,v.Z)().mark((function e(n){var t,r,s,a,c,i,o,m;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.name,r=n.id,s=n.photoURL,a=l.id>r?l.id+r:r+l.id,c=h.find((function(e){return e.id===a})),e.prev=5,c||(i=r,d((0,Z.d8)({combinedId:a,name:t,friendId:i,photo:s}))),e.next=9,(0,b.QT)((0,b.JU)(f,"chats",a));case 9:if(e.sent.exists()){e.next=17;break}return e.next=13,(0,b.pl)((0,b.JU)(f,"chats",a),{messages:[]});case 13:return e.next=15,(0,b.r7)((0,b.JU)(f,"chatsList",l.id),(o={},(0,p.Z)(o,a+".userInfo",{id:r,displayName:t,photo:s}),(0,p.Z)(o,a+".date",(0,b.Bt)()),o));case 15:return e.next=17,(0,b.r7)((0,b.JU)(f,"chatsList",r),(m={},(0,p.Z)(m,a+".userInfo",{id:l.id,displayName:l.name,photo:l.photo}),(0,p.Z)(m,a+".date",(0,b.Bt)()),m));case 17:u(!1),e.next=24;break;case 20:e.prev=20,e.t0=e.catch(5),u(!0),console.error(e.t0);case 24:case"end":return e.stop()}}),e,null,[[5,20]])})));return function(n){return e.apply(this,arguments)}}(),B=(0,y.bx)(),D=(0,N.useRef)();function z(){if(null!==D.current&&void 0!==D.current){var e=a.current.offsetHeight,n=B.navRef.current.offsetHeight,t=window.innerHeight-(e+n);D.current.style.height="".concat(t,"px")}}return(0,N.useEffect)((function(){return z(),window.addEventListener("onload",z),function(){return window.addEventListener("resize",z)}}),[T]),(0,S.jsxs)("div",{className:m()(j.Z.container,"container"),children:[(0,S.jsx)("section",{ref:a,className:j.Z.search,id:"search",children:(0,S.jsxs)("div",{className:j.Z.cont,children:[(0,S.jsx)("input",{inputMode:"search",className:m()(j.Z.searchIcon),onKeyUp:function(e){return function(e){e.preventDefault(),13===e.keyCode&&(J(),t(""))}(e)},value:n,onChange:function(e){return t(e.target.value)},type:"search",id:j.Z.searchIcon,placeholder:"Find friend"}),(0,S.jsx)("button",{type:"submit",onClick:function(e){e.preventDefault(),t(""),J()},className:j.Z.loupe,htmlFor:"search-icon",children:(0,S.jsx)("img",{src:g.Z,alt:"Search"})})]})}),(0,S.jsx)("section",{ref:r,className:j.Z.searchList,id:"search-list",children:0===T.length?(0,S.jsx)("div",{className:j.Z.empty,children:"Search list is empty"}):(0,S.jsx)("div",{ref:D,className:m()(j.Z.containerSearchList,"container-search-list"),children:(0,S.jsx)(N.Suspense,{fallback:(0,S.jsx)(w.a,{}),children:(0,S.jsx)(I,{user:T,clickChat:U})})})}),o?(0,S.jsx)(L.T,{propsErr:k,setModuleErr:u}):(0,S.jsx)(S.Fragment,{})]})}var R=N.lazy((function(){return t.e(690).then(t.bind(t,7787))}));function k(){var e=(0,y.bx)(),n=(0,N.useRef)(),t=(0,N.useRef)(),l=(0,N.useState)(""),p=(0,s.Z)(l,2),v=p[0],x=p[1],g=(0,N.useState)(!1),j=(0,s.Z)(g,2),I=j[0],k=j[1],E=(0,_.v9)((function(e){return e.user})),M=(0,b.ad)(),P=(0,_.I0)(),T=(0,_.v9)((function(e){return e.friend.friend})),H=(0,r.Z)(T),J=(0,N.useRef)(),U=(0,N.useRef)(),B=(0,N.useRef)(),D=(0,N.useRef)(null),z=e.modal,C=e.setModal;function K(){if(null!==n.current){var t=n.current.offsetHeight,r=J.current.offsetHeight,s=e.navRef.current.offsetHeight,a=t- -(window.innerHeight-(t+r+s));n.current.style.height="".concat(a,"px")}}return(0,N.useEffect)((function(){var e=(0,b.cf)((0,b.JU)(M,"chatsList",E.id),(function(e){e.data()?(Object.entries(e.data()).map((function(e){var n=e[0];if(n){var t=e[1].userInfo,r=e[1].date.toDate(),s=t.id,a=t.displayName,c=t.photo,i=e[1].lastMessage?e[1].lastMessage.messageText:"No messages",o=r.getTime()?r.getTime():"--:--",u=new Date,d="".concat(r.getDate(),".").concat(r.getMonth()+1,".").concat(r.getFullYear()),f="".concat(u.getDate(),".").concat(u.getMonth()+1,".").concat(u.getFullYear()),h=r.getMinutes().toString();1===h.length&&(h="0".concat(h));var l=T.find((function(e){return e.id===n}));if(d===f){var m="".concat(r.getHours(),":").concat(h);if(l){if(l.timePublic!==o){var _=n,p=i,v=m;P((0,Z.Bx)({friendInfo:_,messageText:p,datePush:v,timePublic:o}))}else if(l.name!==a||l.photo!==c){var x=n;P((0,Z.aE)({friendInfo:x,photo:c,name:a}))}}else P((0,Z.d8)({combinedId:n,name:a,date:m,friendId:s,timePublic:o,lastMessages:i,photo:c}))}else{var g=d;if(l){if(l.timePublic!==o){var j=n,b=i,S=g;P((0,Z.Bx)({friendInfo:j,messageText:b,datePush:S,timePublic:o}))}else if(l.name!==a||l.photo!==c){var N=n;P((0,Z.aE)({friendInfo:N,photo:c,name:a}))}}else P((0,Z.d8)({combinedId:n,name:a,date:g,friendId:s,timePublic:o,lastMessages:i,photo:c}))}}})),k(!1)):k(!0)}));return function(){e()}}),[T]),(0,N.useEffect)((function(){return window.addEventListener("onload",K),K(),function(){return window.addEventListener("resize",K)}}),[T]),(0,N.useEffect)((function(){var n=D.current,t=e.searchRef.current,r=function(e){n.contains(e.target)||t.contains(e.target)||C(!1)};return z||document.addEventListener("click",r),function(){return document.removeEventListener("click",r)}}),[]),(0,S.jsxs)("section",{className:"home",children:[(0,S.jsx)("div",{ref:D,className:z?m()(u,"search-friends, active-modal-search"):m()(u,"search-friends"),children:(0,S.jsx)(F,{searchListRef:B,searchRef:U,text:v,setText:x})}),(0,S.jsx)("section",{className:i,ref:t,children:(0,S.jsxs)("div",{className:m()(o,"container"),children:[(0,S.jsx)("div",{ref:J,className:m()(a,"head"),children:(0,S.jsx)("h2",{className:m()(c,"header"),children:"Friends"})}),(0,S.jsx)("div",{ref:n,className:f,children:(0,S.jsx)("div",{className:m()(d),children:(0,S.jsx)(N.Suspense,{fallback:(0,S.jsx)(w.a,{}),children:T.length>0?H.sort((function(e,n){return n.timePublic-e.timePublic})).map((function(e){return(0,S.jsx)(R,{friend:e},e.id)})):(0,S.jsx)("div",{className:m()(h),children:"Friend list is empty"})})})})]})}),I?(0,S.jsx)(L.T,{setModuleErr:k}):(0,S.jsx)(S.Fragment,{})]})}},1059:function(e,n){n.Z={searchIcon:"Search_searchIcon__2+JeP",searchList:"Search_searchList__Amjcz",search:"Search_search__xXfoW",cont:"Search_cont__yR28o",loupe:"Search_loupe__ab9N9","list-content":"Search_list-content__WxR1l",list:"Search_list__iolTq",user:"Search_user__bbvWu",name:"Search_name__uV342",searchListName:"Search_searchListName__4BQqk",container:"Search_container__DjhSj",containerSearchList:"Search_containerSearchList__v3e9K",empty:"Search_empty__RZhOd"}}}]);
//# sourceMappingURL=234.92b96d4a.chunk.js.map