"use strict";(self.webpackChunkmy_app=self.webpackChunkmy_app||[]).push([[804],{8552:function(e,s,t){t(2791);s.Z=t.p+"static/media/edit.666b6fca3a40a0415e39054d202d0667.svg"},1804:function(e,s,t){t.r(s),t.d(s,{default:function(){return U}});var n=t(4165),a=t(4942),r=t(5861),i=t(885),d=t(7689),c=t(1087),o={header:"MessagesMain_header__EMkYa",or:"MessagesMain_or__g5wuD",user:"MessagesMain_user__TDMJA",userImg:"MessagesMain_userImg__Mop0A",name:"MessagesMain_name__58IH7",online:"MessagesMain_online__FByeQ",dots:"MessagesMain_dots__9N9pU",container:"MessagesMain_container__c2E6N",input:"MessagesMain_input__R5zJ0",send:"MessagesMain_send__tKhge",textArea:"MessagesMain_textArea__v6811",messages:"MessagesMain_messages__eWIbA",empty:"MessagesMain_empty__Un+PR",messagesMe:"MessagesMain_messagesMe__Go3UK",messagesFriend:"MessagesMain_messagesFriend__4kSKR",messageContainerMe:"MessagesMain_messageContainerMe__GIXeF",messageContainerFriend:"MessagesMain_messageContainerFriend__6diH7",dateMe:"MessagesMain_dateMe__XY83U",dateFriend:"MessagesMain_dateFriend__Iu9Pj",dateMessages:"MessagesMain_dateMessages__HlrtQ",deletedInput:"MessagesMain_deletedInput__caMDW",back:"MessagesMain_back__-Z3YD",photoSender:"MessagesMain_photoSender__ZMI70",imgSenderBlock:"MessagesMain_imgSenderBlock__ZJrLC",infoSender:"MessagesMain_infoSender__9F9Tj",desactiveName:"MessagesMain_desactiveName__KMp2g",nameSender:"MessagesMain_nameSender__1ewyf",nameSenderText:"MessagesMain_nameSenderText__-gZpe",editIcon:"MessagesMain_editIcon__8-EL3"},u=t(1694),l=t.n(u),m=t(9434),g=t(2791),f=t(1413),h=t(9062);var p=t.p+"static/media/send.e6e41f470c70eedfe79bcc21222a7720.svg",M=t(2858),x=t(3249),v=t(4778),_=t(4229),w={modal:!1,editMess:{},editText:""};function Z(e,s){switch(s.type){case"modal":return(0,f.Z)((0,f.Z)({},e),{},{modal:s.payload});case"editMess":return(0,f.Z)((0,f.Z)({},e),{},{editMess:s.payload});case"editText":return(0,f.Z)((0,f.Z)({},e),{},{editText:s.payload});case"init":return function(e){return(0,f.Z)({},e)}(s.payload)}}var j=t(184);function y(e){var s=e.stateEditMess,t=e.setSizeWindow,i=e.sendMess,d=e.text,c=e.setMessageText,u=e.handleEvent,l=e.innerRef,Z=e.infoChat,y=(0,m.v9)((function(e){return e.user})),I=(0,h.ad)(),b=(0,g.useRef)(),k=(0,m.I0)();(0,g.useEffect)((function(){function e(){var e=window.visualViewport.height;t(e)}return window.addEventListener("resize",e),function(){e()}}),[]);var S=function(){var e=(0,r.Z)((0,n.Z)().mark((function e(){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,h.r7)((0,h.JU)(I,"chatsList",y.id),(0,a.Z)({},"".concat(Z.id,".viewMessage.newMessView"),!0));case 3:if(!Z.users){e.next=8;break}Object.entries(Z.users).map(function(){var e=(0,r.Z)((0,n.Z)().mark((function e(s){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!1!==s[1].deleted||s[0]===y.id){e.next=3;break}return e.next=3,(0,h.r7)((0,h.JU)(I,"chatsList",s[0]),(0,a.Z)({},"".concat(Z.id,".viewMessage.viewMess"),!0));case 3:case"end":return e.stop()}}),e)})));return function(s){return e.apply(this,arguments)}}()),e.next=10;break;case 8:return e.next=10,(0,h.r7)((0,h.JU)(I,"chatsList",Z.friendId),(0,a.Z)({},"".concat(Z.id,".viewMessage.viewMess"),!0));case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),console.error(e.t0);case 15:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(){return e.apply(this,arguments)}}();(0,g.useEffect)((function(){var e=b.current;e&&e.focus()}),[s[0].modal]);var N=function(){var e=(0,r.Z)((0,n.Z)().mark((function e(){var t,i,d,c,o,u,l,m;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=s[0].editText,i=Z.id,d=s[0].editMess.messageId,Z.lastMessages!==t){e.next=7;break}s[1]({type:"init",payload:w}),e.next=28;break;case 7:return e.next=9,(0,h.QT)((0,h.JU)(I,"chats",i));case 9:if(!(c=e.sent).exists()){e.next=15;break}return o=c.data().messages,u=o.map((function(e){return e.id===d?(k((0,x.Hd)({chatId:i,messageId:d,messageText:t})),(0,f.Z)((0,f.Z)({},e),{},{messageText:t})):e})),e.next=15,(0,h.r7)((0,h.JU)(I,"chats",i),{messages:u});case 15:if(!Z.users){e.next=20;break}Object.entries(Z.users).map(function(){var e=(0,r.Z)((0,n.Z)().mark((function e(s){var r,i;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!1!==s[1].deleted){e.next=6;break}return e.next=3,(0,h.r7)((0,h.JU)(I,"chatsList",s[0]),(0,a.Z)({},"".concat(Z.id,".lastMessage.messageText"),t));case 3:r=t,i=Z.id,k((0,v.jY)({combinedId:i,lastMessages:r}));case 6:case"end":return e.stop()}}),e)})));return function(s){return e.apply(this,arguments)}}()),e.next=27;break;case 20:return e.next=22,(0,h.r7)((0,h.JU)(I,"chatsList",Z.friendId),(0,a.Z)({},"".concat(Z.id,".lastMessage.messageText"),t));case 22:return e.next=24,(0,h.r7)((0,h.JU)(I,"chatsList",y.id),(0,a.Z)({},"".concat(Z.id,".lastMessage.messageText"),t));case 24:l=t,m=Z.id,k((0,_.vh)({combinedId:m,lastMessages:l}));case 27:s[1]({type:"init",payload:w});case 28:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,j.jsx)("section",{className:o.textArea,ref:l,children:s[0].modal?(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)("textarea",{onChange:function(e){return s[1]({type:"editText",payload:e.target.value})},ref:b,value:s[0].editText,onKeyDown:u,name:"messages",id:"textareaEdit",type:"text",className:o.input,rows:"1"}),(0,j.jsx)("button",{onClick:function(){return N()},className:o.send,children:(0,j.jsx)("img",{src:M.Z,alt:"accept"})})]}):(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)("textarea",{onClick:function(){return S()},placeholder:"Enter your message",onKeyDown:u,value:d,onChange:function(e){return c(e.target.value)},name:"messages",id:"textarea",type:"text",className:o.input,rows:"1"}),(0,j.jsx)("button",{onClick:function(){return i()},type:"submit",className:o.send,children:(0,j.jsx)("img",{src:p,alt:"Send"})})]})})}var I=t(4261),b=t(3825),k=t(4244),S=t(9594);t.p;function N(e){var s=e.setSizeWindow,t=e.infoChat,n=e.scrollRef,a=e.stateEditMess,r=(0,m.v9)((function(e){return e.message.messages})),i=(0,m.v9)((function(e){return e.user})),d=r.find((function(e){return e.chatId===t.id})),c=(0,h.ad)(),u=(0,m.I0)(),f=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];(0,g.useEffect)((function(){n.current.scrollTop=n.current.scrollHeight}),[r]),(0,g.useEffect)((function(){return window.addEventListener("onload",s(window.visualViewport.height)),function(){return window.addEventListener("resize",s(window.visualViewport.height))}}),[r,window.innerHeight]),(0,g.useEffect)((function(){var e=(0,h.cf)((0,h.JU)(c,"chats",t.id),(function(e){if(!e.data())return!1;var s=e.data(),n=t.id;s.messages.map((function(e){var s=e.userId,t=e.messageText,a=e.id,r=e.date,i=e.photo,c=e.name,o=f[r.toDate().getDay()],l=r.toDate().getHours(),m=r.toDate().getMinutes().toString();1===m.length&&(m="0".concat(m));var g="".concat(o," ").concat(l,":").concat(m);if(d&&d.messages){var h=d.messages.find((function(e){return e.messageId===a}));void 0!==h&&void 0!==h.photo&&void 0!==i&&h.photo!==i&&u((0,x.xK)({messageId:a,chatId:n,photo:i})),void 0!==h&&void 0!==h.name&&void 0!==c&&h.name!==c&&u((0,x.y1)({messageId:a,chatId:n,name:c})),void 0!==h&&void 0!==t&&void 0!==h.text&&h.text!==t&&u((0,x.Hd)({chatId:n,messageId:a,messageText:t}))}u((0,x.Hz)({name:c,chatId:n,userId:s,messageText:t,datePush:g,messageId:a,photo:i}))}))}));return function(){e()}}),[d]);return r.length>0&&d?d.messages.map((function(e){return e.userId===i.id?(0,j.jsxs)("div",{className:o.messageContainerMe,children:[(0,j.jsxs)("span",{onClick:function(){!function(e,s){var t=e,n=s.messages.find((function(e){return e.messageId===t}));n&&(a[1]({type:"modal",payload:!0}),a[1]({type:"editMess",payload:n}),a[1]({type:"editText",payload:n.text}))}(e.messageId,d)},className:l()("message",o.messagesMe),children:[(0,j.jsx)("span",{children:e.text}),(0,j.jsx)("span",{className:l()(o.dateMessages,o.dateMe),children:e.date})]}),(0,j.jsx)("span",{className:o.infoSender,children:(0,j.jsx)("span",{className:o.imgSenderBlock,children:(0,j.jsx)("img",{className:o.photoSender,src:e.photo?e.photo:b,alt:"Photo user"})})})]},e.messageId):(0,j.jsxs)("div",{className:o.messageContainerFriend,children:[(0,j.jsxs)("span",{className:o.infoSender,children:[(0,j.jsx)("span",{className:o.imgSenderBlock}),(0,j.jsx)("img",{className:o.photoSender,src:e.photo?e.photo:b,alt:"Photo user"})]}),(0,j.jsxs)("span",{className:l()("message",o.messagesFriend),children:[(0,j.jsx)("span",{children:e.text}),(0,j.jsx)("span",{className:l()(o.dateMessages,o.dateFriend),children:e.date})]})]},e.messageId)})):(0,j.jsx)(S.H,{text:"No Messages"})}var T=t(9232),E=t(8552);function U(){var e=(0,m.v9)((function(e){return e.friend.friend})),s=(0,m.v9)((function(e){return e.group.group})),t=(0,m.v9)((function(e){return e.user})),u=(0,d.s0)(),f=(0,g.useRef)(),p=(0,g.useRef)(),M=(0,g.useRef)(),x=(0,h.ad)(),S=Object.values((0,d.UO)()),U=(0,i.Z)(S,1)[0],C=e.find((function(e){return e.id===U}))?e.find((function(e){return e.id===U})):s.find((function(e){return e.id===U})),J=(0,m.I0)(),L=(0,g.useReducer)(T.Yj,T.m5),F=(0,i.Z)(L,2),R=F[0],H=F[1],D=(0,g.useReducer)(Z,w),K=(0,i.Z)(D,2),V=K[0],z=K[1],B=(0,g.useState)(window.visualViewport.height),A=(0,i.Z)(B,2),O=A[0],W=A[1],P=(0,g.useState)(!1),Q=(0,i.Z)(P,2),Y=Q[0],X=Q[1],G=(0,g.useState)(""),q=(0,i.Z)(G,2),$=q[0],ee=q[1],se=function(){var e=(0,r.Z)((0,n.Z)().mark((function e(){var s,r,i,d,c,o,u;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=$,ee(""),""===s){e.next=29;break}return i=(0,I.Z)(),d=h.EK.now(),e.next=7,(0,h.r7)((0,h.JU)(x,"chats",C.id),{messages:(0,h.vr)({id:i,messageText:s,userId:t.id,date:d,photo:t.photo,name:t.name,deleted:!1})});case 7:return e.next=9,(0,h.r7)((0,h.JU)(x,"chatsList",t.id),(r={},(0,a.Z)(r,C.id+".lastMessage",{messageText:s}),(0,a.Z)(r,C.id+".date",(0,h.Bt)()),(0,a.Z)(r,C.id+".viewMessage",{newMessView:!0,idSender:t.id,viewMess:!1}),r));case 9:if(!C.users){e.next=23;break}e.t0=(0,n.Z)().keys(C.users);case 11:if((e.t1=e.t0()).done){e.next=21;break}return c=e.t1.value,e.next=15,(0,h.QT)((0,h.JU)(x,"chatsList",c));case 15:if(!e.sent.exists()){e.next=19;break}return e.next=19,(0,h.r7)((0,h.JU)(x,"chatsList",c),(o={},(0,a.Z)(o,C.id+".lastMessage",{messageText:s}),(0,a.Z)(o,C.id+".date",(0,h.Bt)()),(0,a.Z)(o,C.id+".viewMessage",{newMessView:!1,idSender:t.id,viewMess:!1}),o));case 19:e.next=11;break;case 21:e.next=29;break;case 23:return e.next=25,(0,h.QT)((0,h.JU)(x,"chatsList",C.friendId));case 25:if(!e.sent.exists()){e.next=29;break}return e.next=29,(0,h.r7)((0,h.JU)(x,"chatsList",C.friendId),(u={},(0,a.Z)(u,C.id+".lastMessage",{messageText:s}),(0,a.Z)(u,C.id+".date",(0,h.Bt)()),(0,a.Z)(u,C.id+".viewMessage",{newMessView:!1,idSender:t.id,viewMess:!1}),u));case 29:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,g.useEffect)((function(){var e=(0,h.cf)((0,h.JU)(x,"chatsList",t.id),(function(e){var s=!!e.data()&&Object.entries(e.data());if(s){var n=s.find((function(e){return e[0]===C.id})),a=n&&n[1].viewMessage,r=a&&a.viewMess,i=a&&a.idSender,d=a&&a.newMessView;if(n&&n[1].chat){var c=n[0],o=n[1].name?n[1].name.name:"",u=n[1].photo.photo;if(n[1].deleted.deleted)return J((0,_.aE)({name:o,photo:u,combinedId:c})),void X(!0);J((0,_.aE)({name:o,photo:u,combinedId:c})),X(!1),J((0,_.XC)({newMess:d,view:r,combinedId:c,idSender:i}))}else if(n&&n[1].group){for(var l=n[0],m=Object.entries(n[1].group.users),g=n[1].group.users,f=Object.entries(C.users),h=0;h<m.length;h++)m[h][1].deleted!==f[h][1].deleted&&J((0,v.ei)({combinedId:l,users:g})),m[h][1].admin&&m[h][1].id===t.id&&H({type:"admin",payload:!0});J((0,v._U)({newMess:d,view:r,combinedId:l,idSender:i}))}}}));return function(){e()}}),[C]),(0,g.useEffect)((function(){if(null!==p.current){var e=f.current.offsetHeight,s=M.current.offsetHeight,t=window.visualViewport.height-(e+s);p.current.style.height="".concat(t,"px"),p.current.scrollTop=p.current.scrollHeight}}),[O]),(0,j.jsx)("section",{className:o.messagesSec,children:(0,j.jsxs)("div",{className:l()(o.container,"container"),children:[(0,j.jsxs)("header",{className:o.header,ref:f,children:[(0,j.jsxs)("div",{className:o.user,children:[R.admin&&(0,j.jsx)(c.rU,{state:C,to:"/edit-group",children:(0,j.jsx)("img",{className:o.editIcon,src:E.Z,alt:"edit"})}),(0,j.jsx)("div",{className:o.userImg,children:(0,j.jsx)("img",{src:null!==C.photo?C.photo:b,alt:"User"})}),(0,j.jsx)("div",{className:o.about,children:(0,j.jsx)("h2",{className:o.name,children:C.name})})]}),(0,j.jsx)("div",{onClick:function(){u("/")},className:o.back,children:(0,j.jsx)("img",{src:k.Z,alt:"back"})})]}),(0,j.jsx)("section",{ref:p,id:"scroll",className:V.modal?l()(o.noScroll,o.messages):o.messages,children:(0,j.jsx)(N,{stateEditMess:[V,z],setSizeWindow:W,scrollRef:p,infoChat:C})}),Y?(0,j.jsx)("div",{ref:M,className:l()(o.deletedInput),children:"Account has been deleted"}):(0,j.jsx)(y,{stateEditMess:[V,z],infoChat:C,scrollRef:p,setSizeWindow:W,innerRef:M,handleEvent:function(e){"Enter"===e.code&&!1===e.ctrlKey&&!1===e.shiftKey&&(e.preventDefault(),se())},sendMess:se,text:$,setMessageText:ee})]})})}}}]);
//# sourceMappingURL=804.1d238d95.chunk.js.map