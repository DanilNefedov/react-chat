"use strict";(self.webpackChunkmy_app=self.webpackChunkmy_app||[]).push([[287],{1287:function(e,n,t){t.r(n),t.d(n,{default:function(){return k}});var r=t(2982),s=t(885),a="Friends_head__z9KAn",i="Friends_header__2vtis",c="Friends_friends__RuUv0",d="Friends_container__Ji6-h",o="Friends_searchFriends__o9ewN",u="Friends_containerFriendsList__ZbZT9",l="Friends_scrollMessages__a2NvB",f="Friends_emptyBlock__ZwYFc",h=t(1694),v=t.n(h),m=t(9434),p=t(4942),_=t(4165),x=t(5861),w=t(8516),g=t(1059),S=t(4229),Z=t(9062),y=t(2791),j=t(7689),N=t(2010),b=t(2789),M=t(4426),I=t(184),L=y.lazy((function(){return t.e(291).then(t.bind(t,3291))}));function R(e){var n=e.text,t=e.setText,r=e.searchListRef,a=e.searchRef,i=(0,y.useReducer)(M.ro,M.fI),c=(0,s.Z)(i,2),d=c[0],o=c[1],u=(0,m.I0)(),l=(0,Z.ad)(),f=(0,m.v9)((function(e){return e.friend.friend})),h=(0,m.v9)((function(e){return e.user})),R=(0,y.useState)([]),F=(0,s.Z)(R,2),k=F[0],E=F[1],P=function(){var e=(0,x.Z)((0,_.Z)().mark((function e(){var t,r,s;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=(0,Z.IO)((0,Z.hJ)(l,"users"),(0,Z.ar)("name","==",n)),e.prev=1,e.next=4,(0,Z.PL)(t);case 4:r=e.sent,s=[],E([]),r.forEach((function(e){var n=e.data();n.id!==h.id&&(o({type:"resetModal",payload:M.fI}),s.push(n),E(s))})),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(1),o({type:"activeModalWindow",payload:!0}),console.error(e.t0);case 14:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(){return e.apply(this,arguments)}}(),T=function(){var e=(0,x.Z)((0,_.Z)().mark((function e(n){var t,r,s,a,i,c,d,v;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.name,r=n.id,s=n.photoURL,a=h.id>r?h.id+r:r+h.id,i=f.find((function(e){return e.id===a})),e.prev=5,i||(c=r,u((0,S.d8)({combinedId:a,name:t,friendId:c,photo:s}))),e.next=9,(0,Z.QT)((0,Z.JU)(l,"chats",a));case 9:if(e.sent.exists()){e.next=17;break}return e.next=13,(0,Z.pl)((0,Z.JU)(l,"chats",a),{messages:[]});case 13:return e.next=15,(0,Z.r7)((0,Z.JU)(l,"chatsList",h.id),(d={},(0,p.Z)(d,a+".userInfo",{id:r,displayName:t,photo:s}),(0,p.Z)(d,a+".date",(0,Z.Bt)()),(0,p.Z)(d,a+".viewMessage",{view:!1,idSender:h.id}),(0,p.Z)(d,a+".idSender",{idSender:h.id}),(0,p.Z)(d,a+".viewNewMessage",{viewNewMess:!0}),d));case 15:return e.next=17,(0,Z.r7)((0,Z.JU)(l,"chatsList",r),(v={},(0,p.Z)(v,a+".userInfo",{id:h.id,displayName:h.name,photo:h.photo}),(0,p.Z)(v,a+".date",(0,Z.Bt)()),(0,p.Z)(v,a+".viewMessage",{view:!1}),(0,p.Z)(v,a+".idSender",{idSender:h.id}),(0,p.Z)(v,a+".viewNewMessage",{viewNewMess:!1}),v));case 17:o({type:"resetModal",payload:M.fI}),e.next=24;break;case 20:e.prev=20,e.t0=e.catch(5),o({type:"activeModalWindow",payload:!0}),console.error(e.t0);case 24:case"end":return e.stop()}}),e,null,[[5,20]])})));return function(n){return e.apply(this,arguments)}}(),H=(0,j.bx)(),J=(0,y.useRef)();function U(){if(null!==J.current&&void 0!==J.current){var e=a.current.offsetHeight,n=H.navRef.current.offsetHeight,t=window.innerHeight-(e+n);J.current.style.height="".concat(t,"px")}}return(0,y.useEffect)((function(){return U(),window.addEventListener("onload",U),function(){return window.addEventListener("resize",U)}}),[k]),(0,I.jsxs)("div",{className:v()(g.Z.container,"container"),children:[(0,I.jsx)("section",{ref:a,className:g.Z.search,id:"search",children:(0,I.jsxs)("div",{className:g.Z.cont,children:[(0,I.jsx)("input",{inputMode:"search",className:v()(g.Z.searchIcon),onKeyUp:function(e){return function(e){e.preventDefault(),13===e.keyCode&&(P(),t(""))}(e)},value:n,onChange:function(e){return t(e.target.value)},type:"search",id:g.Z.searchIcon,placeholder:"Find friend"}),(0,I.jsx)("button",{type:"submit",onClick:function(e){e.preventDefault(),t(""),P()},className:g.Z.loupe,htmlFor:"search-icon",children:(0,I.jsx)("img",{src:w.Z,alt:"Search"})})]})}),(0,I.jsx)("section",{ref:r,className:g.Z.searchList,id:"search-list",children:0===k.length?(0,I.jsx)("div",{className:g.Z.empty,children:"Search list is empty"}):(0,I.jsx)("div",{ref:J,className:v()(g.Z.containerSearchList,"container-search-list"),children:(0,I.jsx)(y.Suspense,{fallback:(0,I.jsx)(b.a,{}),children:(0,I.jsx)(L,{user:k,clickChat:T})})})}),d.activeModalWindow?(0,I.jsx)(N.T,{state:[d,o]}):(0,I.jsx)(I.Fragment,{})]})}var F=y.lazy((function(){return t.e(382).then(t.bind(t,5382))}));function k(){var e=(0,j.bx)(),n=(0,y.useRef)(),t=(0,y.useRef)(),h=(0,y.useState)(""),p=(0,s.Z)(h,2),_=p[0],x=p[1],w=(0,y.useReducer)(M.ro,M.fI),g=(0,s.Z)(w,2),L=g[0],k=g[1],E=(0,m.v9)((function(e){return e.user})),P=(0,Z.ad)(),T=(0,m.I0)(),H=(0,m.v9)((function(e){return e.friend.friend})),J=(0,r.Z)(H),U=(0,y.useRef)(),W=(0,y.useRef)(),B=(0,y.useRef)(),C=(0,y.useRef)(null),D=e.modal,z=e.setModal;function K(){if(null!==n.current){var t=n.current.offsetHeight,r=U.current.offsetHeight,s=e.navRef.current.offsetHeight,a=t- -(window.innerHeight-(t+r+s));n.current.style.height="".concat(a,"px")}}return(0,y.useEffect)((function(){var e=(0,Z.cf)((0,Z.JU)(P,"chatsList",E.id),(function(e){e.data()?(Object.entries(e.data()).map((function(e){var n=e[0];if(n){var t=H.find((function(e){return e.id===n})),r=e[1].userInfo,s=e[1].date.toDate(),a=r.id,i=r.displayName,c=r.photo,d=e[1].lastMessage?e[1].lastMessage.messageText:"No messages",o=s.getTime()?s.getTime():"--:--",u=new Date,l="".concat(s.getDate(),".").concat(s.getMonth()+1,".").concat(s.getFullYear()),f="".concat(u.getDate(),".").concat(u.getMonth()+1,".").concat(u.getFullYear()),h=e[1].viewMessage.view,v=e[1].idSender?e[1].idSender.idSender:null,m=e[1].viewNewMessage.viewNewMess,p=s.getMinutes().toString();if(1===p.length&&(p="0".concat(p)),l===f){var _="".concat(s.getHours(),":").concat(p);if(t){if(t.timePublic!==o){var x=n,w=d,g=_;T((0,S.Bx)({idSender:v,view:h,friendInfo:x,messageText:w,datePush:g,timePublic:o}))}else if(t.name!==i||t.photo!==c){var Z=n;T((0,S.aE)({friendInfo:Z,photo:c,name:i}))}}else T((0,S.d8)({newMess:m,view:h,combinedId:n,name:i,date:_,friendId:a,timePublic:o,lastMessages:d,photo:c,idSender:v}))}else{var y=l;if(t){if(t.timePublic!==o){var j=n,N=d,b=y;T((0,S.Bx)({idSender:v,view:h,friendInfo:j,messageText:N,datePush:b,timePublic:o}))}else if(t.name!==i||t.photo!==c){var M=n;T((0,S.aE)({friendInfo:M,photo:c,name:i}))}}else T((0,S.d8)({newMess:m,view:h,combinedId:n,name:i,date:y,friendId:a,timePublic:o,lastMessages:d,photo:c,idSender:v}))}T((0,S.XC)({newMess:m,view:h,combinedId:n,idSender:v}))}})),k({type:"resetModal",payload:M.fI})):k({type:"activeModalWindow",payload:!0})}));return function(){e()}}),[H]),(0,y.useEffect)((function(){return window.addEventListener("onload",K),K(),function(){return window.addEventListener("resize",K)}}),[H]),(0,y.useEffect)((function(){var n=C.current,t=e.searchRef.current,r=function(e){n.contains(e.target)||t.contains(e.target)||z(!1)};return D||document.addEventListener("click",r),function(){return document.removeEventListener("click",r)}}),[]),(0,I.jsxs)("section",{className:"home",children:[(0,I.jsx)("div",{ref:C,className:D?v()(o,"search-friends, active-modal-search"):v()(o,"search-friends"),children:(0,I.jsx)(R,{searchListRef:B,searchRef:W,text:_,setText:x})}),(0,I.jsx)("section",{className:c,ref:t,children:(0,I.jsxs)("div",{className:v()(d,"container"),children:[(0,I.jsx)("div",{ref:U,className:v()(a,"head"),children:(0,I.jsx)("h2",{className:v()(i,"header"),children:"Friends"})}),(0,I.jsx)("div",{ref:n,className:l,children:(0,I.jsx)("div",{className:v()(u),children:(0,I.jsx)(y.Suspense,{fallback:(0,I.jsx)(b.a,{}),children:H.length>0?J.sort((function(e,n){return n.timePublic-e.timePublic})).map((function(e){return(0,I.jsx)(F,{friend:e},e.id)})):(0,I.jsx)("div",{className:v()(f),children:"Friend list is empty"})})})})]})}),L.activeModalWindow?(0,I.jsx)(N.T,{state:[L,k]}):(0,I.jsx)(I.Fragment,{})]})}},1059:function(e,n){n.Z={searchIcon:"Search_searchIcon__2+JeP",searchList:"Search_searchList__Amjcz",search:"Search_search__xXfoW",cont:"Search_cont__yR28o",loupe:"Search_loupe__ab9N9","list-content":"Search_list-content__WxR1l",list:"Search_list__iolTq",user:"Search_user__bbvWu",name:"Search_name__uV342",searchListName:"Search_searchListName__4BQqk",container:"Search_container__DjhSj",containerSearchList:"Search_containerSearchList__v3e9K",empty:"Search_empty__RZhOd"}}}]);
//# sourceMappingURL=287.ad6ddce4.chunk.js.map