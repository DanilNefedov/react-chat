{"version":3,"file":"static/js/287.774a5d90.chunk.js","mappings":"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","sources":["webpack://my-app/./src/Components/HomePage/Friends.module.css?e856","Components/Search/Search.js","Components/HomePage/Friends.js","webpack://my-app/./src/Components/Search/Search.module.css?a5fe"],"sourcesContent":["// extracted by mini-css-extract-plugin\nexport default {\"head\":\"Friends_head__z9KAn\",\"header\":\"Friends_header__2vtis\",\"dots\":\"Friends_dots__hKwNl\",\"friends\":\"Friends_friends__RuUv0\",\"container\":\"Friends_container__Ji6-h\",\"searchFriends\":\"Friends_searchFriends__o9ewN\",\"containerFriendsList\":\"Friends_containerFriendsList__ZbZT9\",\"scrollMessages\":\"Friends_scrollMessages__a2NvB\",\"emptyBlock\":\"Friends_emptyBlock__ZwYFc\"};","import search from '../../img/search.svg';\r\nimport style from './Search.module.css'\r\nimport { useDispatch, useSelector } from 'react-redux';\r\nimport { addFrined } from '../../store/friendSlice';\r\nimport { collection, doc, getDoc, getDocs, getFirestore, query, serverTimestamp, setDoc, updateDoc, where } from 'firebase/firestore';\r\nimport { Suspense, useEffect, useReducer, useRef, useState } from 'react';\r\nimport { useOutletContext } from 'react-router-dom';\r\nimport { ModuleError } from '../ModalError/ModalError';\r\nimport classNames from 'classnames';\r\nimport { Loader } from '../Loader/Loader';\r\nimport React from 'react';\r\nimport { initialStateModal, reducerModal } from '../../state/modalError';\r\n\r\nconst SearchList = React.lazy(() => import('./SearchList'))\r\n\r\nexport function Search({ text, setText, searchListRef, searchRef, navRef }) {\r\n    const [stateModal, dispatchModal] = useReducer(reducerModal, initialStateModal)\r\n    const dispatch = useDispatch()\r\n    const db = getFirestore()\r\n    const friend = useSelector(state => state.friend.friend)\r\n    const myInfo = useSelector(state => state.user)\r\n    const [user, setUser] = useState([]) \r\n\r\n    const handleSubmit = (event) => {\r\n        event.preventDefault();\r\n        setText('')\r\n        searchUsers()\r\n    }  \r\n\r\n    const handleEvent = (e) => {\r\n        e.preventDefault();\r\n        if (e.keyCode === 13) {\r\n            searchUsers()\r\n            setText('')\r\n        }\r\n    }\r\n\r\n\r\n    const searchUsers = async () => {\r\n        const q = query(collection(db, \"users\"), where('name', '==', text));\r\n        \r\n        try {\r\n            const querySnapshot = await getDocs(q);\r\n            const searchArr = []\r\n            setUser([])\r\n\r\n            querySnapshot.forEach((doc) => {\r\n                const data = doc.data()\r\n                if(data.id !== myInfo.id){\r\n                    dispatchModal({type:'resetModal', payload:initialStateModal})\r\n                    searchArr.push(data)\r\n                    setUser(searchArr)\r\n                }\r\n            });\r\n\r\n        } catch (error) {\r\n            dispatchModal({type:'activeModalWindow', payload:true})\r\n            console.error(error)\r\n        }\r\n    }\r\n\r\n\r\n\r\n    const bindChat = async (el) => {\r\n        const name = el.name;\r\n        const id = el.id;\r\n        const photo = el.photoURL\r\n        const combinedId = myInfo.id > id ? myInfo.id + id : id + myInfo.id\r\n        const find = friend.find(el => el.id === combinedId)\r\n\r\n        try {\r\n            if (!find) {\r\n                const friendId = id\r\n                dispatch(addFrined({ combinedId, name, friendId, photo }))\r\n            }\r\n            const res = await getDoc(doc(db, 'chats', combinedId))\r\n            if (!res.exists()) {\r\n\r\n                await setDoc(doc(db, 'chats', combinedId), { messages: [] })\r\n\r\n                await updateDoc(doc(db, 'chatsList', myInfo.id), {\r\n                    [combinedId + '.userInfo']: {\r\n                        id: id,\r\n                        displayName: name,\r\n                        photo: photo\r\n                    },\r\n                    [combinedId + '.date']: serverTimestamp(),\r\n                    [combinedId + '.viewMessage'] :{\r\n                        view: false,\r\n                        idSender:myInfo.id\r\n                    },\r\n                    [combinedId + '.idSender'] :{\r\n                        idSender:myInfo.id\r\n                    },\r\n                    [combinedId + '.viewNewMessage'] :{\r\n                        viewNewMess: true\r\n                    }\r\n                })\r\n\r\n                await updateDoc(doc(db, 'chatsList', id), {\r\n                    [combinedId + '.userInfo']: {\r\n                        id: myInfo.id,\r\n                        displayName: myInfo.name,\r\n                        photo: myInfo.photo\r\n                    },\r\n                    [combinedId + '.date']: serverTimestamp(),\r\n                    [combinedId + '.viewMessage'] :{\r\n                        view: false,\r\n                    },\r\n                    [combinedId + '.idSender'] :{\r\n                        idSender:myInfo.id\r\n                    },\r\n                    [combinedId + '.viewNewMessage'] :{\r\n                        viewNewMess: false\r\n                    }\r\n                })\r\n            }\r\n            dispatchModal({type:'resetModal', payload:initialStateModal})\r\n        } catch (error) {\r\n            dispatchModal({type:'activeModalWindow', payload:true})\r\n            console.error(error)\r\n        }\r\n    }\r\n\r\n    const context = useOutletContext()\r\n    const containerSearch = useRef()\r\n    \r\n    function resize() {\r\n        if (containerSearch.current !== null && containerSearch.current !== undefined) {\r\n            const searchHeight = searchRef.current.offsetHeight\r\n            const navigationRefHeight = navRef.current.offsetHeight\r\n            const windowHeight = window.innerHeight\r\n\r\n            const sum = searchHeight + navigationRefHeight\r\n\r\n            const res = windowHeight - sum\r\n\r\n            containerSearch.current.style.height = `${res}px`\r\n        }\r\n    }\r\n\r\n\r\n    useEffect(() => {\r\n        resize()\r\n        window.addEventListener(\"onload\", resize);\r\n        return () => window.addEventListener(\"resize\", resize);\r\n    }, [user])\r\n\r\n\r\n\r\n\r\n    return (\r\n        <div className={classNames(style.container, \"container\")}>\r\n            <section ref={searchRef} className={style.search} id=\"search\">\r\n                <div className={style.cont}>\r\n                    <input inputMode='search' className={classNames(style.searchIcon)} onKeyUp={ (e) => handleEvent(e)} value={text} onChange={(e) => setText(e.target.value)} type=\"search\" id={style.searchIcon} placeholder=\"Find friend\" />\r\n                    <button type='submit' onClick={handleSubmit} className={style.loupe} htmlFor=\"search-icon\"><img src={search} alt=\"Search\" /></button>\r\n\r\n                </div>\r\n\r\n            </section>\r\n            <section ref={searchListRef} className={style.searchList} id=\"search-list\">\r\n\r\n                {(user.length === 0) ? (\r\n                    <div className={style.empty}>Search list is empty</div>\r\n                ) : (\r\n                    <div ref={containerSearch} className={classNames(style.containerSearchList, \"container-search-list\")}>\r\n                        <Suspense fallback={<Loader></Loader>}>\r\n                            <SearchList user={user} clickChat={bindChat} />\r\n                        </Suspense>\r\n                    </div>\r\n                )}\r\n\r\n            </section>\r\n            {stateModal.activeModalWindow ? <ModuleError state={[stateModal, dispatchModal]}></ModuleError> : <></>}\r\n        </div>\r\n\r\n\r\n    );\r\n\r\n}","import style from './Friends.module.css';\r\nimport classNames from 'classnames';\r\nimport { useDispatch, useSelector } from 'react-redux';\r\nimport { Search } from '../Search/Search'\r\nimport { addFrined, addLastMessage, updatePhotoName, viewMessage } from '../../store/friendSlice'\r\nimport React, { Suspense, useReducer, useRef, useState } from 'react';\r\nimport { getFirestore, doc, onSnapshot } from 'firebase/firestore';\r\nimport { useEffect } from 'react';\r\nimport { useOutletContext } from 'react-router-dom';\r\nimport { ModuleError } from '../ModalError/ModalError';\r\nimport { Loader } from '../Loader/Loader';\r\nimport { initialStateModal, reducerModal } from '../../state/modalError';\r\nimport { UserNavigation } from '../UserNavigation/UserNavigation';\r\n\r\n\r\nconst FriendsList = React.lazy(() => import('./FriendsList/FriendsList'))\r\n\r\n\r\nexport default function Friends() {\r\n    const [activeModal, setActiveModal] = useState(false)\r\n    const navRef = useRef()\r\n    const searchRefUser = useRef()\r\n    const containerFrineds = useRef()\r\n    const friendsScroll = useRef()\r\n    const [text, setText] = useState('')\r\n    const [stateModal, dispatchModal] = useReducer(reducerModal, initialStateModal)\r\n    const myInfo = useSelector(state => state.user)\r\n    const db = getFirestore();\r\n    const dispatch = useDispatch()\r\n    const friendList = useSelector(state => state.friend.friend)\r\n    const sortState = [...friendList]\r\n    const headRef = useRef()\r\n    const searchRef = useRef();\r\n    const searchListRef = useRef();       \r\n    const refSearch = useRef(null)\r\n\r\n    useEffect(() => {\r\n        const unsub = onSnapshot(doc(db, \"chatsList\", myInfo.id), (doc) => {\r\n            if (doc.data()) {\r\n                const data = Object.entries(doc.data())\r\n                data.map(el => {\r\n                    const combinedId = el[0]\r\n                    if (combinedId) {\r\n                        const find = friendList.find(el => el.id === combinedId)\r\n                        const userInfo = el[1].userInfo\r\n                        const userDate = el[1].date.toDate()//some error\r\n                        const friendId = userInfo.id\r\n                        const name = userInfo.displayName\r\n                        const photo = userInfo.photo\r\n                        const lastMessages = el[1].lastMessage ? el[1].lastMessage.messageText : 'No messages'\r\n                        const timePublic = userDate.getTime() ? userDate.getTime() : '--:--'\r\n                        const dateUserNow = new Date()\r\n                        const findMyDayBase = `${userDate.getDate()}.${userDate.getMonth()+1}.${userDate.getFullYear()}`\r\n                        const findMyDayUser = `${dateUserNow.getDate()}.${dateUserNow.getMonth()+1}.${dateUserNow.getFullYear()}`\r\n                        const view = el[1].viewMessage.view \r\n                        const idSender = el[1].idSender ? el[1].idSender.idSender : null\r\n                        const newMess = el[1].viewNewMessage.viewNewMess \r\n                        //console.log(newMess)\r\n\r\n                        let minute = userDate.getMinutes().toString()\r\n                        if (minute.length === 1) {\r\n                            minute = `0${minute}`\r\n                        }\r\n                        \r\n                        if(findMyDayBase === findMyDayUser){\r\n                            const date = `${userDate.getHours()}:${minute}`//maybe err in userDate\r\n\r\n                            if (!find) {\r\n                                dispatch(addFrined({newMess, view, combinedId, name, date, friendId, timePublic, lastMessages, photo, idSender }))\r\n                                \r\n                            } else if (find.timePublic !== timePublic) {\r\n                                const friendInfo = combinedId\r\n                                const messageText = lastMessages\r\n                                const datePush = date\r\n                                dispatch(addLastMessage({idSender,  view, friendInfo, messageText, datePush, timePublic }))\r\n\r\n                            }else if (find.name !== name || find.photo !== photo) {\r\n                                const friendInfo = combinedId\r\n                                dispatch(updatePhotoName({ friendInfo, photo, name }))\r\n                            }\r\n\r\n                        }else {\r\n                            const date = findMyDayBase\r\n                            if (!find) {\r\n                                dispatch(addFrined({newMess, view, combinedId, name, date, friendId, timePublic, lastMessages, photo, idSender }))\r\n                            } else if (find.timePublic !== timePublic) {\r\n                                const friendInfo = combinedId\r\n                                const messageText = lastMessages\r\n                                const datePush = date\r\n                                dispatch(addLastMessage({idSender,  view, friendInfo, messageText, datePush, timePublic }))\r\n\r\n                            }else if (find.name !== name || find.photo !== photo) {\r\n                                const friendInfo = combinedId\r\n                                dispatch(updatePhotoName({ friendInfo, photo, name }))\r\n                            }\r\n                        }\r\n                        dispatch(viewMessage({newMess, view,combinedId,idSender}))\r\n                    }  \r\n                })\r\n                dispatchModal({type:'resetModal', payload:initialStateModal})\r\n            } else {\r\n                dispatchModal({type:'activeModalWindow', payload:true})\r\n                return \r\n            }\r\n\r\n        });\r\n        return () => {\r\n            unsub()\r\n        }\r\n    }, [ friendList]) \r\n\r\n    function resize() {\r\n        if (containerFrineds.current !== null) {\r\n            const containerFrinedsHeight = containerFrineds.current.offsetHeight\r\n            const headRefHeight = headRef.current.offsetHeight\r\n            const navigationRefHeight = navRef.current.offsetHeight\r\n            const windowHeight = window.innerHeight\r\n\r\n            const sum = containerFrinedsHeight + headRefHeight + navigationRefHeight\r\n\r\n            const res = windowHeight - sum\r\n\r\n            const newHeight = containerFrinedsHeight - (-res)\r\n\r\n            containerFrineds.current.style.height = `${newHeight}px`\r\n        }\r\n    }\r\n\r\n    useEffect(() => {\r\n        window.addEventListener(\"onload\", resize);\r\n        resize()\r\n        return () => window.addEventListener(\"resize\", resize);\r\n    }, [friendList])\r\n\r\n\r\n    useEffect(()=>{\r\n        const searchBlock = refSearch.current\r\n        const searchActiveBlock = searchRefUser.current\r\n        const onClick = e => {    \r\n            if(!searchBlock.contains(e.target)){\r\n                if(searchActiveBlock !== undefined && !searchActiveBlock.contains(e.target)){\r\n                    setActiveModal(false)\r\n                }\r\n            } \r\n        }\r\n\r\n        if(!activeModal){\r\n            document.addEventListener('click', onClick);\r\n        }\r\n        return () => document.removeEventListener('click', onClick);\r\n    }, [])\r\n\r\n\r\n    return (\r\n    <>\r\n        <UserNavigation setActiveModal={setActiveModal} innerRef={navRef} searchRefUser={searchRefUser}/>\r\n        <section className=\"home\">\r\n            <div ref={refSearch} className={activeModal ? classNames(style.searchFriends, \"search-friends, active-modal-search\") : classNames(style.searchFriends, \"search-friends\")}>\r\n                <Search navRef={navRef} searchListRef={searchListRef} searchRef={searchRef}  text={text} setText={setText}  />\r\n            </div> \r\n            <section className={style.friends} ref={friendsScroll}>\r\n\r\n                <div className={classNames(style.container, 'container')}>\r\n                    <div ref={headRef} className={classNames(style.head, 'head')}>\r\n                        <h2 className={classNames(style.header, 'header')}>\r\n                            Friends\r\n                        </h2>\r\n                    </div>\r\n                    <div ref={containerFrineds} className={style.scrollMessages}>\r\n                        <div className={classNames(style.containerFriendsList)}>\r\n                            <Suspense fallback={<Loader></Loader>}>\r\n                                {(friendList.length > 0 ) ? (\r\n                                    sortState.sort((a,b) => b.timePublic - a.timePublic).map((friend) => ( \r\n                                        <FriendsList key={friend.id} friend={friend}></FriendsList>\r\n                                    ))\r\n                                ):(\r\n                                    <div className={classNames(style.emptyBlock)}>Friend list is empty</div>\r\n                                )}\r\n                            </Suspense>\r\n                        </div>\r\n                        \r\n                    </div>\r\n                </div>\r\n            </section>\r\n            {stateModal.activeModalWindow ? <ModuleError state={[stateModal, dispatchModal]}></ModuleError> : <></>}\r\n        </section>\r\n    </>\r\n        \r\n    );\r\n}\r\n","// extracted by mini-css-extract-plugin\nexport default {\"searchIcon\":\"Search_searchIcon__2+JeP\",\"searchList\":\"Search_searchList__Amjcz\",\"search\":\"Search_search__xXfoW\",\"cont\":\"Search_cont__yR28o\",\"loupe\":\"Search_loupe__ab9N9\",\"list-content\":\"Search_list-content__WxR1l\",\"list\":\"Search_list__iolTq\",\"user\":\"Search_user__bbvWu\",\"name\":\"Search_name__uV342\",\"searchListName\":\"Search_searchListName__4BQqk\",\"container\":\"Search_container__DjhSj\",\"containerSearchList\":\"Search_containerSearchList__v3e9K\",\"empty\":\"Search_empty__RZhOd\"};"],"names":["SearchList","React","Search","text","setText","searchListRef","searchRef","navRef","useReducer","reducerModal","initialStateModal","stateModal","dispatchModal","dispatch","useDispatch","db","getFirestore","friend","useSelector","state","myInfo","user","useState","setUser","searchUsers","q","query","collection","where","getDocs","querySnapshot","searchArr","forEach","doc","data","id","type","payload","push","console","error","bindChat","el","name","photo","photoURL","combinedId","find","friendId","addFrined","getDoc","exists","setDoc","messages","updateDoc","displayName","serverTimestamp","view","idSender","viewNewMess","containerSearch","useOutletContext","useRef","resize","current","undefined","searchHeight","offsetHeight","navigationRefHeight","res","window","innerHeight","style","height","useEffect","addEventListener","className","classNames","ref","inputMode","onKeyUp","e","preventDefault","keyCode","handleEvent","value","onChange","target","placeholder","onClick","event","htmlFor","src","search","alt","length","Suspense","fallback","Loader","clickChat","activeModalWindow","FriendsList","Friends","activeModal","setActiveModal","searchRefUser","containerFrineds","friendsScroll","friendList","sortState","headRef","refSearch","containerFrinedsHeight","headRefHeight","newHeight","unsub","onSnapshot","Object","entries","map","userInfo","userDate","date","toDate","lastMessages","lastMessage","messageText","timePublic","getTime","dateUserNow","Date","findMyDayBase","getDate","getMonth","getFullYear","findMyDayUser","viewMessage","newMess","viewNewMessage","minute","getMinutes","toString","getHours","friendInfo","datePush","addLastMessage","updatePhotoName","searchBlock","searchActiveBlock","contains","document","removeEventListener","UserNavigation","innerRef","sort","a","b"],"sourceRoot":""}