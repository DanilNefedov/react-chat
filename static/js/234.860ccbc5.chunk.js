"use strict";(self.webpackChunkmy_app=self.webpackChunkmy_app||[]).push([[234],{2234:function(e,n,t){t.r(n),t.d(n,{default:function(){return R}});var r=t(4165),s=t(5861),a=t(2982),c=t(885),i="Friends_head__z9KAn",o="Friends_header__2vtis",u="Friends_friends__RuUv0",d="Friends_container__Ji6-h",h="Friends_searchFriends__o9ewN",f="Friends_containerFriendsList__ZbZT9",l="Friends_scrollMessages__a2NvB",m="Friends_emptyBlock__ZwYFc",p=t(1694),_=t.n(p),v=t(9434),x=t(4942),g=t(8516),j=t(1059),b=t(4229),Z=t(9062),S=t(184);var N=t(2791),w=t(7689),L=t(865),y=t(2789),E=N.lazy((function(){return t.e(291).then(t.bind(t,3291))}));function I(e){var n=e.propsErr,t=e.user,a=e.handleSubmit,i=e.text,o=e.setText,u=e.handleEvent,d=e.searchListRef,h=e.searchRef,f=(0,N.useState)(!1),l=(0,c.Z)(f,2),m=l[0],p=l[1],I=(0,v.I0)(),F=(0,Z.ad)(),R=(0,v.v9)((function(e){return e.friend.friend})),k=(0,v.v9)((function(e){return e.user})),M=function(){var e=(0,s.Z)((0,r.Z)().mark((function e(n){var t,s,a,c,i,o,u,d;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.name,s=n.id,a=n.photoURL,c=k.id>s?k.id+s:s+k.id,i=R.find((function(e){return e.id===c})),e.prev=5,i||(o=s,I((0,b.d8)({combinedId:c,name:t,friendId:o,photo:a}))),e.next=9,(0,Z.QT)((0,Z.JU)(F,"chats",c));case 9:if(e.sent.exists()){e.next=17;break}return e.next=13,(0,Z.pl)((0,Z.JU)(F,"chats",c),{messages:[]});case 13:return e.next=15,(0,Z.r7)((0,Z.JU)(F,"chatsList",k.id),(u={},(0,x.Z)(u,c+".userInfo",{id:s,displayName:t,photo:a}),(0,x.Z)(u,c+".date",(0,Z.Bt)()),u));case 15:return e.next=17,(0,Z.r7)((0,Z.JU)(F,"chatsList",s),(d={},(0,x.Z)(d,c+".userInfo",{id:k.id,displayName:k.name,photo:k.photo}),(0,x.Z)(d,c+".date",(0,Z.Bt)()),d));case 17:p(!1),e.next=24;break;case 20:e.prev=20,e.t0=e.catch(5),p(!0),console.error(e.t0);case 24:case"end":return e.stop()}}),e,null,[[5,20]])})));return function(n){return e.apply(this,arguments)}}(),P=(0,w.bx)(),T=(0,N.useRef)();function H(){if(null!==T.current&&void 0!==T.current){var e=h.current.offsetHeight,n=P.navRef.current.offsetHeight,t=window.innerHeight-(e+n);T.current.style.height="".concat(t,"px")}}return(0,N.useEffect)((function(){return H(),window.addEventListener("onload",H),function(){return window.addEventListener("resize",H)}}),[t]),(0,S.jsxs)("div",{className:_()(j.Z.container,"container"),children:[(0,S.jsx)("section",{ref:h,className:j.Z.search,id:"search",children:(0,S.jsxs)("div",{className:j.Z.cont,children:[(0,S.jsx)("input",{inputMode:"search",className:_()(j.Z.searchIcon),onKeyDown:u,value:i,onChange:function(e){return o(e.target.value)},type:"text",id:j.Z.searchIcon,placeholder:"Find friend"}),(0,S.jsx)("button",{type:"submit",onClick:a,className:j.Z.loupe,htmlFor:"search-icon",children:(0,S.jsx)("img",{src:g.Z,alt:"Search"})})]})}),(0,S.jsx)("section",{ref:d,className:j.Z.searchList,id:"search-list",children:0===t.length?(0,S.jsx)("div",{className:j.Z.empty,children:"Search list is empty"}):(0,S.jsx)("div",{ref:T,className:_()(j.Z.containerSearchList,"container-search-list"),children:(0,S.jsx)(N.Suspense,{fallback:(0,S.jsx)(y.a,{}),children:(0,S.jsx)(E,{user:t,clickChat:M})})})}),m?(0,S.jsx)(L.T,{propsErr:n,setModuleErr:p}):(0,S.jsx)(S.Fragment,{})]})}var F=N.lazy((function(){return t.e(690).then(t.bind(t,7787))}));function R(){var e=(0,w.bx)(),n=(0,N.useRef)(),t=(0,N.useRef)(),p=(0,N.useState)(""),x=(0,c.Z)(p,2),g=x[0],j=x[1],E=(0,N.useState)([]),R=(0,c.Z)(E,2),k=R[0],M=R[1],P=(0,N.useState)(!1),T=(0,c.Z)(P,2),H=T[0],J=T[1],B=(0,N.useState)(""),D=(0,c.Z)(B,2),U=D[0],z=D[1],C=(0,v.v9)((function(e){return e.user})),K=(0,Z.ad)(),O=(0,v.I0)(),W=(0,v.v9)((function(e){return e.friend.friend})),Y=(0,a.Z)(W),q=(0,N.useRef)(),A=(0,N.useRef)(),Q=(0,N.useRef)(),V=(0,N.useRef)(null),X=e.modal,G=e.setModal,$=function(){var e=(0,s.Z)((0,r.Z)().mark((function e(){var n,t,s;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(0,Z.IO)((0,Z.hJ)(K,"users"),(0,Z.ar)("name","==",g)),e.prev=1,e.next=4,(0,Z.PL)(n);case 4:t=e.sent,s=[],M([]),t.forEach((function(e){var n=e.data();J(!1),s.push(n),M(s)})),e.next=15;break;case 10:e.prev=10,e.t0=e.catch(1),J(!0),z(""),console.error(e.t0);case 15:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(){return e.apply(this,arguments)}}();function ee(){if(null!==n.current){var t=n.current.offsetHeight,r=q.current.offsetHeight,s=e.navRef.current.offsetHeight,a=t- -(window.innerHeight-(t+r+s));n.current.style.height="".concat(a,"px")}}return(0,N.useEffect)((function(){var e=(0,Z.cf)((0,Z.JU)(K,"chatsList",C.id),(function(e){e.data()?(Object.entries(e.data()).map((function(e){var n=e[0];if(n){var t=e[1].userInfo,r=e[1].date.toDate(),s=t.id,a=t.displayName,c=t.photo,i=e[1].lastMessage?e[1].lastMessage.messageText:"No messages",o=r.getTime()?r.getTime():"--:--",u=new Date,d="".concat(r.getDate(),".").concat(r.getMonth()+1,".").concat(r.getFullYear()),h="".concat(u.getDate(),".").concat(u.getMonth()+1,".").concat(u.getFullYear()),f=r.getMinutes().toString();1===f.length&&(f="0".concat(f));var l=W.find((function(e){return e.id===n}));if(d===h){var m="".concat(r.getHours(),":").concat(f);if(l){if(l.timePublic!==o){var p=n,_=i,v=m;O((0,b.Bx)({friendInfo:p,messageText:_,datePush:v,timePublic:o}))}else if(l.name!==a||l.photo!==c){var x=n;O((0,b.aE)({friendInfo:x,photo:c,name:a}))}}else O((0,b.d8)({combinedId:n,name:a,date:m,friendId:s,timePublic:o,lastMessages:i,photo:c}))}else{var g=d;if(l){if(l.timePublic!==o){var j=n,Z=i,S=g;O((0,b.Bx)({friendInfo:j,messageText:Z,datePush:S,timePublic:o}))}else if(l.name!==a||l.photo!==c){var N=n;O((0,b.aE)({friendInfo:N,photo:c,name:a}))}}else O((0,b.d8)({combinedId:n,name:a,date:g,friendId:s,timePublic:o,lastMessages:i,photo:c}))}}})),J(!1)):J(!0)}));return function(){e()}}),[C.id,W.map((function(e){return e}))]),(0,N.useEffect)((function(){return window.addEventListener("onload",ee),ee(),function(){return window.addEventListener("resize",ee)}}),[W]),(0,N.useEffect)((function(){var n=V.current,t=e.searchRef.current,r=function(e){n.contains(e.target)||t.contains(e.target)||G(!1)};return X||document.addEventListener("click",r),function(){return document.removeEventListener("click",r)}}),[]),(0,S.jsxs)("section",{className:"home",children:[(0,S.jsx)("div",{ref:V,className:X?_()(h,"search-friends, active-modal-search"):_()(h,"search-friends"),children:(0,S.jsx)(I,{searchListRef:Q,searchRef:A,user:k,handleSubmit:function(e){e.preventDefault(),j(""),$()},text:g,setText:j,handleEvent:function(e){"Enter"===e.code&&($(),j(""))}})}),(0,S.jsx)("section",{className:u,ref:t,children:(0,S.jsxs)("div",{className:_()(d,"container"),children:[(0,S.jsx)("div",{ref:q,className:_()(i,"head"),children:(0,S.jsx)("h2",{className:_()(o,"header"),children:"Friends"})}),(0,S.jsx)("div",{ref:n,className:l,children:(0,S.jsx)("div",{className:_()(f),children:(0,S.jsx)(N.Suspense,{fallback:(0,S.jsx)(y.a,{}),children:W.length>0?Y.sort((function(e,n){return n.timePublic-e.timePublic})).map((function(e){return(0,S.jsx)(F,{friend:e},e.id)})):(0,S.jsx)("div",{className:_()(m),children:"Friend list is empty"})})})})]})}),H?(0,S.jsx)(L.T,{propsErr:U,setModuleErr:J}):(0,S.jsx)(S.Fragment,{})]})}},1059:function(e,n){n.Z={searchIcon:"Search_searchIcon__2+JeP",searchList:"Search_searchList__Amjcz",search:"Search_search__xXfoW",cont:"Search_cont__yR28o",loupe:"Search_loupe__ab9N9","list-content":"Search_list-content__WxR1l",list:"Search_list__iolTq",user:"Search_user__bbvWu",name:"Search_name__uV342",searchListName:"Search_searchListName__4BQqk",container:"Search_container__DjhSj",containerSearchList:"Search_containerSearchList__v3e9K",empty:"Search_empty__RZhOd"}}}]);
//# sourceMappingURL=234.860ccbc5.chunk.js.map