"use strict";(self.webpackChunkmy_app=self.webpackChunkmy_app||[]).push([[234],{2234:function(e,n,t){t.r(n),t.d(n,{default:function(){return k}});var r=t(4165),s=t(5861),a=t(2982),c=t(885),i="Friends_head__z9KAn",o="Friends_header__2vtis",u="Friends_friends__RuUv0",d="Friends_container__Ji6-h",f="Friends_searchFriends__o9ewN",l="Friends_containerFriendsList__ZbZT9",h="Friends_scrollMessages__a2NvB",m="Friends_emptyBlock__ZwYFc",v=t(1694),p=t.n(v),_=t(9434),x=t(4942),g=t(8516),j=t(1059),b=t(4229),Z=t(9062),S=t(184);function N(){return(0,S.jsx)("div",{className:"empty",children:"Search list is empty"})}var w=t(2791),L=t(7689),E=t(865),I=t(2789),y=w.lazy((function(){return t.e(291).then(t.bind(t,3291))}));function F(e){var n=e.propsErr,t=e.user,a=e.handleSubmit,i=e.text,o=e.setText,u=e.handleEvent,d=e.searchListRef,f=e.searchRef,l=(0,w.useState)(!1),h=(0,c.Z)(l,2),m=h[0],v=h[1],F=(0,_.I0)(),R=(0,Z.ad)(),k=(0,_.v9)((function(e){return e.friend.friend})),P=(0,_.v9)((function(e){return e.user})),T=function(){var e=(0,s.Z)((0,r.Z)().mark((function e(n){var t,s,a,c,i,o,u,d;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.name,s=n.id,a=n.photoURL,c=P.id>s?P.id+s:s+P.id,i=k.find((function(e){return e.id===c})),e.prev=5,i||(o=s,F((0,b.d8)({combinedId:c,name:t,friendId:o,photo:a}))),e.next=9,(0,Z.QT)((0,Z.JU)(R,"chats",c));case 9:if(e.sent.exists()){e.next=17;break}return e.next=13,(0,Z.pl)((0,Z.JU)(R,"chats",c),{messages:[]});case 13:return e.next=15,(0,Z.r7)((0,Z.JU)(R,"chatsList",P.id),(u={},(0,x.Z)(u,c+".userInfo",{id:s,displayName:t,photo:a}),(0,x.Z)(u,c+".date",(0,Z.Bt)()),u));case 15:return e.next=17,(0,Z.r7)((0,Z.JU)(R,"chatsList",s),(d={},(0,x.Z)(d,c+".userInfo",{id:P.id,displayName:P.name,photo:P.photo}),(0,x.Z)(d,c+".date",(0,Z.Bt)()),d));case 17:v(!1),e.next=24;break;case 20:e.prev=20,e.t0=e.catch(5),v(!0),console.error(e.t0);case 24:case"end":return e.stop()}}),e,null,[[5,20]])})));return function(n){return e.apply(this,arguments)}}(),M=(0,L.bx)(),H=(0,w.useRef)();function J(){if(console.log(),null!==H.current&&void 0!==H.current){var e=f.current.offsetHeight,n=M.navRef.current.offsetHeight,t=window.innerHeight-(e+n);H.current.style.height="".concat(t,"px")}}return(0,w.useEffect)((function(){return J(),window.addEventListener("onload",J),function(){return window.addEventListener("resize",J)}}),[t]),(0,S.jsxs)("div",{className:p()(j.Z.container,"container"),children:[(0,S.jsx)("section",{ref:f,className:j.Z.search,id:"search",children:(0,S.jsxs)("div",{className:j.Z.cont,children:[(0,S.jsx)("input",{className:p()(j.Z.searchIcon),onKeyDown:u,value:i,onChange:function(e){return o(e.target.value)},type:"text",id:j.Z.searchIcon,placeholder:"Find friend"}),(0,S.jsx)("button",{type:"submit",onClick:a,className:j.Z.loupe,htmlFor:"search-icon",children:(0,S.jsx)("img",{src:g.Z,alt:"Search"})})]})}),(0,S.jsx)("section",{ref:d,className:j.Z.searchList,id:"search-list",children:0===t.length?(0,S.jsx)(N,{}):(0,S.jsx)("div",{ref:H,className:p()(j.Z.containerSearchList,"container-search-list"),children:(0,S.jsx)(w.Suspense,{fallback:(0,S.jsx)(I.a,{}),children:(0,S.jsx)(y,{user:t,clickChat:T})})})}),m?(0,S.jsx)(E.T,{propsErr:n,setModuleErr:v}):(0,S.jsx)(S.Fragment,{})]})}var R=w.lazy((function(){return t.e(690).then(t.bind(t,7787))}));function k(){var e=(0,L.bx)(),n=(0,w.useRef)(),t=(0,w.useRef)(),v=(0,w.useState)(""),x=(0,c.Z)(v,2),g=x[0],j=x[1],N=(0,w.useState)([]),y=(0,c.Z)(N,2),k=y[0],P=y[1],T=(0,w.useState)(!1),M=(0,c.Z)(T,2),H=M[0],J=M[1],B=(0,w.useState)(""),D=(0,c.Z)(B,2),U=D[0],z=D[1],C=(0,_.v9)((function(e){return e.user})),K=(0,Z.ad)(),W=(0,_.I0)(),Y=(0,_.v9)((function(e){return e.friend.friend})),q=(0,a.Z)(Y),A=(0,w.useRef)(),O=(0,w.useRef)(),Q=(0,w.useRef)(),V=(0,w.useRef)(null),X=e.modal,G=e.setModal,$=function(){var e=(0,s.Z)((0,r.Z)().mark((function e(){var n,t,s;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(0,Z.IO)((0,Z.hJ)(K,"users"),(0,Z.ar)("name","==",g)),e.prev=1,e.next=4,(0,Z.PL)(n);case 4:t=e.sent,s=[],P([]),t.forEach((function(e){var n=e.data();J(!1),s.push(n),P(s)})),e.next=15;break;case 10:e.prev=10,e.t0=e.catch(1),J(!0),z(""),console.error(e.t0);case 15:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(){return e.apply(this,arguments)}}();function ee(){if(null!==n.current){var t=n.current.offsetHeight,r=A.current.offsetHeight,s=e.navRef.current.offsetHeight,a=t- -(window.innerHeight-(t+r+s));n.current.style.height="".concat(a,"px")}}return(0,w.useEffect)((function(){var e=(0,Z.cf)((0,Z.JU)(K,"chatsList",C.id),(function(e){e.data()?(Object.entries(e.data()).map((function(e){var n=e[0];if(n){var t=e[1].userInfo,r=e[1].date.toDate(),s=t.id,a=t.displayName,c=t.photo,i=e[1].lastMessage?e[1].lastMessage.messageText:"No messages",o=r.getTime()?r.getTime():"--:--",u=new Date,d="".concat(r.getDate(),".").concat(r.getMonth()+1,".").concat(r.getFullYear()),f="".concat(u.getDate(),".").concat(u.getMonth()+1,".").concat(u.getFullYear()),l=r.getMinutes().toString();1===l.length&&(l="0".concat(l));var h=Y.find((function(e){return e.id===n}));if(d===f){var m="".concat(r.getHours(),":").concat(l);if(h){if(h.timePublic!==o){var v=n,p=i,_=m;W((0,b.Bx)({friendInfo:v,messageText:p,datePush:_,timePublic:o}))}else if(h.name!==a||h.photo!==c){var x=n;W((0,b.aE)({friendInfo:x,photo:c,name:a}))}}else W((0,b.d8)({combinedId:n,name:a,date:m,friendId:s,timePublic:o,lastMessages:i,photo:c}))}else{var g=d;if(h){if(h.timePublic!==o){var j=n,Z=i,S=g;W((0,b.Bx)({friendInfo:j,messageText:Z,datePush:S,timePublic:o}))}else if(h.name!==a||h.photo!==c){var N=n;W((0,b.aE)({friendInfo:N,photo:c,name:a}))}}else W((0,b.d8)({combinedId:n,name:a,date:g,friendId:s,timePublic:o,lastMessages:i,photo:c}))}}})),J(!1)):J(!0)}));return function(){e()}}),[C.id,Y.map((function(e){return e}))]),(0,w.useEffect)((function(){return window.addEventListener("onload",ee),ee(),function(){return window.addEventListener("resize",ee)}}),[Y]),(0,w.useEffect)((function(){var n=V.current,t=e.searchRef.current,r=function(e){n.contains(e.target)||t.contains(e.target)||G(!1)};return X||document.addEventListener("click",r),function(){return document.removeEventListener("click",r)}}),[]),(0,S.jsxs)("section",{className:"home",children:[(0,S.jsx)("div",{ref:V,className:X?p()(f,"search-friends, active-modal-search"):p()(f,"search-friends"),children:(0,S.jsx)(F,{searchListRef:Q,searchRef:O,user:k,handleSubmit:function(e){e.preventDefault(),j(""),$()},text:g,setText:j,handleEvent:function(e){"Enter"===e.code&&($(),j(""))}})}),(0,S.jsx)("section",{className:u,ref:t,children:(0,S.jsxs)("div",{className:p()(d,"container"),children:[(0,S.jsx)("div",{ref:A,className:p()(i,"head"),children:(0,S.jsx)("h2",{className:p()(o,"header"),children:"Friends"})}),(0,S.jsx)("div",{ref:n,className:h,children:(0,S.jsx)("div",{className:p()(l),children:(0,S.jsx)(w.Suspense,{fallback:(0,S.jsx)(I.a,{}),children:Y.length>0?q.sort((function(e,n){return n.timePublic-e.timePublic})).map((function(e){return(0,S.jsx)(R,{friend:e},e.id)})):(0,S.jsx)("div",{className:p()(m),children:"Friend list is empty"})})})})]})}),H?(0,S.jsx)(E.T,{propsErr:U,setModuleErr:J}):(0,S.jsx)(S.Fragment,{})]})}},1059:function(e,n){n.Z={searchIcon:"Search_searchIcon__2+JeP",searchList:"Search_searchList__Amjcz",search:"Search_search__xXfoW",cont:"Search_cont__yR28o",loupe:"Search_loupe__ab9N9","list-content":"Search_list-content__WxR1l",list:"Search_list__iolTq",user:"Search_user__bbvWu",name:"Search_name__uV342",searchListName:"Search_searchListName__4BQqk",container:"Search_container__DjhSj",containerSearchList:"Search_containerSearchList__v3e9K"}}}]);
//# sourceMappingURL=234.3323cd01.chunk.js.map