"use strict";(self.webpackChunkmy_app=self.webpackChunkmy_app||[]).push([[287],{1287:function(e,n,t){t.r(n),t.d(n,{default:function(){return E}});var r=t(2982),s=t(885),a="Friends_head__z9KAn",i="Friends_header__2vtis",c="Friends_friends__RuUv0",d="Friends_container__Ji6-h",o="Friends_searchFriends__o9ewN",u="Friends_containerFriendsList__ZbZT9",l="Friends_scrollMessages__a2NvB",f="Friends_emptyBlock__ZwYFc",h=t(1694),v=t.n(h),m=t(9434),p=t(4942),_=t(4165),x=t(5861),w=t(8516),g=t(1059),S=t(4229),Z=t(9062),j=t(2791),y=t(7689),N=t(2010),M=t(2789),b=t(4426),I=t(184),R=j.lazy((function(){return t.e(291).then(t.bind(t,3291))}));function L(e){var n=e.text,t=e.setText,r=e.searchListRef,a=e.searchRef,i=e.navRef,c=(0,j.useReducer)(b.ro,b.fI),d=(0,s.Z)(c,2),o=d[0],u=d[1],l=(0,m.I0)(),f=(0,Z.ad)(),h=(0,m.v9)((function(e){return e.friend.friend})),L=(0,m.v9)((function(e){return e.user})),F=(0,j.useState)([]),k=(0,s.Z)(F,2),E=k[0],P=k[1],T=function(){var e=(0,x.Z)((0,_.Z)().mark((function e(){var t,r,s;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=(0,Z.IO)((0,Z.hJ)(f,"users"),(0,Z.ar)("name","==",n.trim())),e.prev=1,e.next=4,(0,Z.PL)(t);case 4:r=e.sent,s=[],P([]),r.forEach((function(e){var n=e.data();n.id!==L.id&&(u({type:"resetModal",payload:b.fI}),s.push(n),P(s))})),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(1),u({type:"activeModalWindow",payload:!0}),console.error(e.t0);case 14:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(){return e.apply(this,arguments)}}(),U=function(){var e=(0,x.Z)((0,_.Z)().mark((function e(n){var t,r,s,a,i,c,d,o;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.name,r=n.id,s=n.photoURL,a=L.id>r?L.id+r:r+L.id,i=h.find((function(e){return e.id===a})),e.prev=5,i||(c=r,l((0,S.d8)({combinedId:a,name:t,friendId:c,photo:s}))),e.next=9,(0,Z.QT)((0,Z.JU)(f,"chats",a));case 9:if(e.sent.exists()){e.next=17;break}return e.next=13,(0,Z.pl)((0,Z.JU)(f,"chats",a),{messages:[]});case 13:return e.next=15,(0,Z.r7)((0,Z.JU)(f,"chatsList",L.id),(d={},(0,p.Z)(d,a+".userInfo",{id:r,displayName:t,photo:s}),(0,p.Z)(d,a+".date",(0,Z.Bt)()),(0,p.Z)(d,a+".viewMessage",{view:!1,idSender:L.id}),(0,p.Z)(d,a+".idSender",{idSender:L.id}),(0,p.Z)(d,a+".viewNewMessage",{viewNewMess:!0}),d));case 15:return e.next=17,(0,Z.r7)((0,Z.JU)(f,"chatsList",r),(o={},(0,p.Z)(o,a+".userInfo",{id:L.id,displayName:L.name,photo:L.photo}),(0,p.Z)(o,a+".date",(0,Z.Bt)()),(0,p.Z)(o,a+".viewMessage",{view:!1}),(0,p.Z)(o,a+".idSender",{idSender:L.id}),(0,p.Z)(o,a+".viewNewMessage",{viewNewMess:!1}),o));case 17:u({type:"resetModal",payload:b.fI}),e.next=24;break;case 20:e.prev=20,e.t0=e.catch(5),u({type:"activeModalWindow",payload:!0}),console.error(e.t0);case 24:case"end":return e.stop()}}),e,null,[[5,20]])})));return function(n){return e.apply(this,arguments)}}(),H=((0,y.bx)(),(0,j.useRef)());function J(){if(null!==H.current&&void 0!==H.current){var e=a.current.offsetHeight,n=i.current.offsetHeight,t=window.innerHeight-(e+n);H.current.style.height="".concat(t,"px")}}return(0,j.useEffect)((function(){return J(),window.addEventListener("onload",J),function(){return window.addEventListener("resize",J)}}),[E]),(0,I.jsxs)("div",{className:v()(g.Z.container,"container"),children:[(0,I.jsx)("section",{ref:a,className:g.Z.search,id:"search",children:(0,I.jsxs)("div",{className:g.Z.cont,children:[(0,I.jsx)("input",{inputMode:"search",className:v()(g.Z.searchIcon),onKeyUp:function(e){return function(e){e.preventDefault(),13===e.keyCode&&(T(),t(""))}(e)},value:n,onChange:function(e){return t(e.target.value)},type:"search",id:g.Z.searchIcon,placeholder:"Find friend"}),(0,I.jsx)("button",{type:"submit",onClick:function(e){e.preventDefault(),t(""),T()},className:g.Z.loupe,htmlFor:"search-icon",children:(0,I.jsx)("img",{src:w.Z,alt:"Search"})})]})}),(0,I.jsx)("section",{ref:r,className:g.Z.searchList,id:"search-list",children:0===E.length?(0,I.jsx)("div",{className:g.Z.empty,children:"Search list is empty"}):(0,I.jsx)("div",{ref:H,className:v()(g.Z.containerSearchList,"container-search-list"),children:(0,I.jsx)(j.Suspense,{fallback:(0,I.jsx)(M.a,{}),children:(0,I.jsx)(R,{user:E,clickChat:U})})})}),o.activeModalWindow?(0,I.jsx)(N.T,{state:[o,u]}):(0,I.jsx)(I.Fragment,{})]})}var F=t(60),k=j.lazy((function(){return t.e(382).then(t.bind(t,5382))}));function E(){var e=(0,j.useState)(!1),n=(0,s.Z)(e,2),t=n[0],h=n[1],p=(0,j.useRef)(),_=(0,j.useRef)(),x=(0,j.useRef)(),w=(0,j.useRef)(),g=(0,j.useState)(""),y=(0,s.Z)(g,2),R=y[0],E=y[1],P=(0,j.useReducer)(b.ro,b.fI),T=(0,s.Z)(P,2),U=T[0],H=T[1],J=(0,m.v9)((function(e){return e.user})),W=(0,Z.ad)(),B=(0,m.I0)(),C=(0,m.v9)((function(e){return e.friend.friend})),D=(0,r.Z)(C),z=(0,j.useRef)(),A=(0,j.useRef)(),K=(0,j.useRef)(),O=(0,j.useRef)(null);function Y(){if(null!==x.current){var e=x.current.offsetHeight,n=z.current.offsetHeight,t=p.current.offsetHeight,r=e- -(window.innerHeight-(e+n+t));x.current.style.height="".concat(r,"px")}}return(0,j.useEffect)((function(){var e=(0,Z.cf)((0,Z.JU)(W,"chatsList",J.id),(function(e){e.data()?(Object.entries(e.data()).map((function(e){var n=e[0];if(n){var t=C.find((function(e){return e.id===n})),r=e[1].userInfo,s=e[1].date.toDate(),a=r.id,i=r.displayName,c=r.photo,d=e[1].lastMessage?e[1].lastMessage.messageText:"No messages",o=s.getTime()?s.getTime():"--:--",u=new Date,l="".concat(s.getDate(),".").concat(s.getMonth()+1,".").concat(s.getFullYear()),f="".concat(u.getDate(),".").concat(u.getMonth()+1,".").concat(u.getFullYear()),h=e[1].viewMessage.view,v=e[1].idSender?e[1].idSender.idSender:null,m=e[1].viewNewMessage.viewNewMess,p=s.getMinutes().toString();if(1===p.length&&(p="0".concat(p)),l===f){var _="".concat(s.getHours(),":").concat(p);if(t){if(t.timePublic!==o){var x=n,w=d,g=_;B((0,S.Bx)({idSender:v,view:h,friendInfo:x,messageText:w,datePush:g,timePublic:o}))}else if(t.name!==i||t.photo!==c){var Z=n;B((0,S.aE)({friendInfo:Z,photo:c,name:i}))}}else B((0,S.d8)({newMess:m,view:h,combinedId:n,name:i,date:_,friendId:a,timePublic:o,lastMessages:d,photo:c,idSender:v}))}else{var j=l;if(t){if(t.timePublic!==o){var y=n,N=d,M=j;B((0,S.Bx)({idSender:v,view:h,friendInfo:y,messageText:N,datePush:M,timePublic:o}))}else if(t.name!==i||t.photo!==c){var b=n;B((0,S.aE)({friendInfo:b,photo:c,name:i}))}}else B((0,S.d8)({newMess:m,view:h,combinedId:n,name:i,date:j,friendId:a,timePublic:o,lastMessages:d,photo:c,idSender:v}))}B((0,S.XC)({newMess:m,view:h,combinedId:n,idSender:v}))}})),H({type:"resetModal",payload:b.fI})):H({type:"activeModalWindow",payload:!0})}));return function(){e()}}),[C]),(0,j.useEffect)((function(){return window.addEventListener("onload",Y),Y(),function(){return window.addEventListener("resize",Y)}}),[C]),(0,j.useEffect)((function(){var e=O.current,n=_.current,r=function(t){e.contains(t.target)||void 0===n||n.contains(t.target)||h(!1)};return t||document.addEventListener("click",r),function(){return document.removeEventListener("click",r)}}),[]),(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(F.n,{setActiveModal:h,innerRef:p,searchRefUser:_}),(0,I.jsxs)("section",{className:"home",children:[(0,I.jsx)("div",{ref:O,className:t?v()(o,"search-friends, active-modal-search"):v()(o,"search-friends"),children:(0,I.jsx)(L,{navRef:p,searchListRef:K,searchRef:A,text:R,setText:E})}),(0,I.jsx)("section",{className:c,ref:w,children:(0,I.jsxs)("div",{className:v()(d,"container"),children:[(0,I.jsx)("div",{ref:z,className:v()(a,"head"),children:(0,I.jsx)("h2",{className:v()(i,"header"),children:"Friends"})}),(0,I.jsx)("div",{ref:x,className:l,children:(0,I.jsx)("div",{className:v()(u),children:(0,I.jsx)(j.Suspense,{fallback:(0,I.jsx)(M.a,{}),children:C.length>0?D.sort((function(e,n){return n.timePublic-e.timePublic})).map((function(e){return(0,I.jsx)(k,{friend:e},e.id)})):(0,I.jsx)("div",{className:v()(f),children:"Friend list is empty"})})})})]})}),U.activeModalWindow?(0,I.jsx)(N.T,{state:[U,H]}):(0,I.jsx)(I.Fragment,{})]})]})}},1059:function(e,n){n.Z={searchIcon:"Search_searchIcon__2+JeP",searchList:"Search_searchList__Amjcz",search:"Search_search__xXfoW",cont:"Search_cont__yR28o",loupe:"Search_loupe__ab9N9","list-content":"Search_list-content__WxR1l",list:"Search_list__iolTq",user:"Search_user__bbvWu",name:"Search_name__uV342",searchListName:"Search_searchListName__4BQqk",container:"Search_container__DjhSj",containerSearchList:"Search_containerSearchList__v3e9K",empty:"Search_empty__RZhOd"}}}]);
//# sourceMappingURL=287.4a9c34ce.chunk.js.map