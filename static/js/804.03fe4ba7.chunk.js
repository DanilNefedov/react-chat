"use strict";(self.webpackChunkmy_app=self.webpackChunkmy_app||[]).push([[804],{8552:function(e,s,t){t(2791);s.Z=t.p+"static/media/edit.666b6fca3a40a0415e39054d202d0667.svg"},1804:function(e,s,t){t.r(s),t.d(s,{default:function(){return J}});var a=t(4165),n=t(4942),r=t(5861),i=t(885),d=t(7689),c=t(1087),o={header:"MessagesMain_header__EMkYa",or:"MessagesMain_or__g5wuD",user:"MessagesMain_user__TDMJA",userImg:"MessagesMain_userImg__Mop0A",name:"MessagesMain_name__58IH7",online:"MessagesMain_online__FByeQ",dots:"MessagesMain_dots__9N9pU",container:"MessagesMain_container__c2E6N",input:"MessagesMain_input__R5zJ0",send:"MessagesMain_send__tKhge",textArea:"MessagesMain_textArea__v6811",messages:"MessagesMain_messages__eWIbA",empty:"MessagesMain_empty__Un+PR",messagesMe:"MessagesMain_messagesMe__Go3UK",messagesFriend:"MessagesMain_messagesFriend__4kSKR",messageContainerMe:"MessagesMain_messageContainerMe__GIXeF",messageContainerFriend:"MessagesMain_messageContainerFriend__6diH7",dateMe:"MessagesMain_dateMe__XY83U",dateFriend:"MessagesMain_dateFriend__Iu9Pj",dateMessages:"MessagesMain_dateMessages__HlrtQ",deletedInput:"MessagesMain_deletedInput__caMDW",back:"MessagesMain_back__-Z3YD",photoSender:"MessagesMain_photoSender__ZMI70",imgSenderBlock:"MessagesMain_imgSenderBlock__ZJrLC",infoSender:"MessagesMain_infoSender__9F9Tj",desactiveName:"MessagesMain_desactiveName__KMp2g",nameSender:"MessagesMain_nameSender__1ewyf",nameSenderText:"MessagesMain_nameSenderText__-gZpe",editIcon:"MessagesMain_editIcon__8-EL3",deleteMess:"MessagesMain_deleteMess__VEY-a"},u=t(1694),g=t.n(u),l=t(9434),m=t(2791),f=t(1413),h=t(9062);var x=t.p+"static/media/send.e6e41f470c70eedfe79bcc21222a7720.svg",p=t(2858),M=t(3249),v=t(4778),_=t(4229),w={modal:!1,editMess:{},editText:""};function Z(e,s){switch(s.type){case"modal":return(0,f.Z)((0,f.Z)({},e),{},{modal:s.payload});case"editMess":return(0,f.Z)((0,f.Z)({},e),{},{editMess:s.payload});case"editText":return(0,f.Z)((0,f.Z)({},e),{},{editText:s.payload});case"init":return function(e){return(0,f.Z)({},e)}(s.payload)}}var I=t.p+"static/media/delete-white.775e9dd618f07a57d467dfc4059b0335.svg",b=t(184);function j(e){var s=e.stateEditMess,t=e.setSizeWindow,i=e.sendMess,d=e.text,c=e.setMessageText,u=e.handleEvent,Z=e.innerRef,j=e.infoChat,y=(0,l.v9)((function(e){return e.user})),k=(0,l.v9)((function(e){return e.message.messages})),S=(0,h.ad)(),T=(0,m.useRef)(),N=(0,l.I0)();(0,m.useEffect)((function(){function e(){var e=window.visualViewport.height;t(e)}return window.addEventListener("resize",e),function(){e()}}),[]);var U=function(){var e=(0,r.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,h.r7)((0,h.JU)(S,"chatsList",y.id),(0,n.Z)({},"".concat(j.id,".viewMessage.newMessView"),!0));case 3:if(!j.users){e.next=8;break}Object.entries(j.users).map(function(){var e=(0,r.Z)((0,a.Z)().mark((function e(s){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!1!==s[1].deleted||s[0]===y.id){e.next=3;break}return e.next=3,(0,h.r7)((0,h.JU)(S,"chatsList",s[0]),(0,n.Z)({},"".concat(j.id,".viewMessage.viewMess"),!0));case 3:case"end":return e.stop()}}),e)})));return function(s){return e.apply(this,arguments)}}()),e.next=10;break;case 8:return e.next=10,(0,h.r7)((0,h.JU)(S,"chatsList",j.friendId),(0,n.Z)({},"".concat(j.id,".viewMessage.viewMess"),!0));case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),console.error(e.t0);case 15:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(){return e.apply(this,arguments)}}();(0,m.useEffect)((function(){var e=T.current;e&&e.focus()}),[s[0].modal]);var E=function(){var e=(0,r.Z)((0,a.Z)().mark((function e(){var t,i,d,c,o,u,g,l;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=s[0].editText,i=j.id,d=s[0].editMess.messageId,j.lastMessages!==t&&""!==t.trim()){e.next=7;break}s[1]({type:"init",payload:w}),e.next=28;break;case 7:return e.next=9,(0,h.QT)((0,h.JU)(S,"chats",i));case 9:if(!(c=e.sent).exists()){e.next=15;break}return o=c.data().messages,u=o.map((function(e){return e.id===d?(N((0,M.Hd)({chatId:i,messageId:d,messageText:t})),(0,f.Z)((0,f.Z)({},e),{},{messageText:t})):e})),e.next=15,(0,h.r7)((0,h.JU)(S,"chats",i),{messages:u});case 15:if(!j.users){e.next=20;break}Object.entries(j.users).map(function(){var e=(0,r.Z)((0,a.Z)().mark((function e(s){var r,i;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!1!==s[1].deleted){e.next=6;break}return e.next=3,(0,h.r7)((0,h.JU)(S,"chatsList",s[0]),(0,n.Z)({},"".concat(j.id,".lastMessage.messageText"),t));case 3:r=t,i=j.id,N((0,v.jY)({combinedId:i,lastMessages:r}));case 6:case"end":return e.stop()}}),e)})));return function(s){return e.apply(this,arguments)}}()),e.next=27;break;case 20:return e.next=22,(0,h.r7)((0,h.JU)(S,"chatsList",j.friendId),(0,n.Z)({},"".concat(j.id,".lastMessage.messageText"),t));case 22:return e.next=24,(0,h.r7)((0,h.JU)(S,"chatsList",y.id),(0,n.Z)({},"".concat(j.id,".lastMessage.messageText"),t));case 24:g=t,l=j.id,N((0,_.vh)({combinedId:l,lastMessages:g}));case 27:s[1]({type:"init",payload:w});case 28:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),J=function(){var e=(0,r.Z)((0,a.Z)().mark((function e(){var t,i,d,c,o,u,g,l,m,f;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=j.id,i=s[0].editMess.messageId,d=y.id,N((0,M._A)({chatId:t,messageId:i,userId:d})),e.next=6,(0,h.QT)((0,h.JU)(S,"chats",t));case 6:if(!(c=e.sent).exists()){e.next=13;break}return o=c.data().messages,u=o.findIndex((function(e){return e.id===i})),o.splice(u,1),e.next=13,(0,h.r7)((0,h.JU)(S,"chats",t),{messages:o});case 13:if(g=k.find((function(e){return e.chatId===j.id})),l=g.messages.length>=2?g.messages[g.messages.length-2].text:"No messages",g.messages[g.messages.length-1].messageId!==i){e.next=28;break}if(!j.users){e.next=21;break}Object.entries(j.users).map(function(){var e=(0,r.Z)((0,a.Z)().mark((function e(s){var t,r;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!1!==s[1].deleted){e.next=6;break}return e.next=3,(0,h.r7)((0,h.JU)(S,"chatsList",s[0]),(0,n.Z)({},"".concat(j.id,".lastMessage.messageText"),l));case 3:t=l,r=j.id,N((0,v.jY)({combinedId:r,lastMessages:t}));case 6:case"end":return e.stop()}}),e)})));return function(s){return e.apply(this,arguments)}}()),e.next=28;break;case 21:return e.next=23,(0,h.r7)((0,h.JU)(S,"chatsList",j.friendId),(0,n.Z)({},"".concat(j.id,".lastMessage.messageText"),l));case 23:return e.next=25,(0,h.r7)((0,h.JU)(S,"chatsList",y.id),(0,n.Z)({},"".concat(j.id,".lastMessage.messageText"),l));case 25:m=l,f=j.id,N((0,_.vh)({combinedId:f,lastMessages:m}));case 28:s[1]({type:"init",payload:w});case 29:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,b.jsx)("section",{className:o.textArea,ref:Z,children:s[0].modal?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("textarea",{onChange:function(e){return s[1]({type:"editText",payload:e.target.value})},ref:T,value:s[0].editText,onKeyDown:u,name:"messages",id:"textareaEdit",type:"text",className:o.input,rows:"1"}),(0,b.jsx)("button",{onClick:function(){return J()},className:g()(o.send,o.deleteMess),children:(0,b.jsx)("img",{src:I,alt:"delete message"})}),(0,b.jsx)("button",{onClick:function(){return E()},className:o.send,children:(0,b.jsx)("img",{src:p.Z,alt:"accept"})})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("textarea",{onClick:function(){return U()},placeholder:"Enter your message",onKeyDown:u,value:d,onChange:function(e){return c(e.target.value)},name:"messages",id:"textarea",type:"text",className:o.input,rows:"1"}),(0,b.jsx)("button",{onClick:function(){return i()},type:"submit",className:o.send,children:(0,b.jsx)("img",{src:x,alt:"Send"})})]})})}var y=t(4261),k=t(3825),S=t(4244),T=t(9594);function N(e){var s=e.setSizeWindow,t=e.infoChat,a=e.scrollRef,n=e.stateEditMess,r=(0,l.v9)((function(e){return e.message.messages})),i=(0,l.v9)((function(e){return e.user})),d=r.find((function(e){return e.chatId===t.id})),c=(0,h.ad)(),u=(0,l.I0)(),f=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];(0,m.useEffect)((function(){a.current.scrollTop=a.current.scrollHeight}),[r]),(0,m.useEffect)((function(){return window.addEventListener("onload",s(window.visualViewport.height)),function(){return window.addEventListener("resize",s(window.visualViewport.height))}}),[r,window.innerHeight]),(0,m.useEffect)((function(){var e=(0,h.cf)((0,h.JU)(c,"chats",t.id),(function(e){if(!e.data())return!1;var s=e.data(),a=t.id;if(d&&d.messages&&s.messages.length<d.messages.length)for(var n=0;n<d.messages.length;n++)if(void 0===s.messages[n]||s.messages.length<d.messages.length){console.log("w");var r=d.messages[n].messageId;u((0,M._A)({chatId:a,messageId:r}))}s.messages.map((function(e){var s=e.userId,t=e.messageText,n=e.id,r=e.date,i=e.photo,c=e.name,o=f[r.toDate().getDay()],g=r.toDate().getHours(),l=r.toDate().getMinutes().toString();1===l.length&&(l="0".concat(l));var m="".concat(o," ").concat(g,":").concat(l);if(d&&d.messages){var h=d.messages.find((function(e){return e.messageId===n}));void 0!==h&&void 0!==h.photo&&void 0!==i&&h.photo!==i&&u((0,M.xK)({messageId:n,chatId:a,photo:i})),void 0!==h&&void 0!==h.name&&void 0!==c&&h.name!==c&&u((0,M.y1)({messageId:n,chatId:a,name:c})),void 0!==h&&void 0!==t&&void 0!==h.text&&h.text!==t&&u((0,M.Hd)({chatId:a,messageId:n,messageText:t}))}u((0,M.Hz)({name:c,chatId:a,userId:s,messageText:t,datePush:m,messageId:n,photo:i}))}))}));return function(){e()}}),[d]);return r.length>0&&d&&d.messages.length>0?d.messages.map((function(e){return e.userId===i.id?(0,b.jsxs)("div",{className:o.messageContainerMe,children:[(0,b.jsxs)("span",{onClick:function(){!function(e,s){var t=e,a=s.messages.find((function(e){return e.messageId===t}));a&&(n[1]({type:"modal",payload:!0}),n[1]({type:"editMess",payload:a}),n[1]({type:"editText",payload:a.text}))}(e.messageId,d)},className:g()("message",o.messagesMe),children:[(0,b.jsx)("span",{children:e.text}),(0,b.jsx)("span",{className:g()(o.dateMessages,o.dateMe),children:e.date})]}),(0,b.jsx)("span",{className:o.infoSender,children:(0,b.jsx)("span",{className:o.imgSenderBlock,children:(0,b.jsx)("img",{className:o.photoSender,src:e.photo?e.photo:k,alt:"Photo user"})})})]},e.messageId):(0,b.jsxs)("div",{className:o.messageContainerFriend,children:[(0,b.jsxs)("span",{className:o.infoSender,children:[(0,b.jsx)("span",{className:o.imgSenderBlock}),(0,b.jsx)("img",{className:o.photoSender,src:e.photo?e.photo:k,alt:"Photo user"})]}),(0,b.jsxs)("span",{className:g()("message",o.messagesFriend),children:[(0,b.jsx)("span",{children:e.text}),(0,b.jsx)("span",{className:g()(o.dateMessages,o.dateFriend),children:e.date})]})]},e.messageId)})):(0,b.jsx)(T.H,{text:"No Messages"})}var U=t(9232),E=t(8552);function J(){var e=(0,l.v9)((function(e){return e.friend.friend})),s=(0,l.v9)((function(e){return e.group.group})),t=(0,l.v9)((function(e){return e.user})),u=(0,d.s0)(),f=(0,m.useRef)(),x=(0,m.useRef)(),p=(0,m.useRef)(),M=(0,h.ad)(),I=Object.values((0,d.UO)()),T=(0,i.Z)(I,1)[0],J=e.find((function(e){return e.id===T}))?e.find((function(e){return e.id===T})):s.find((function(e){return e.id===T})),C=(0,l.I0)(),L=(0,m.useReducer)(U.Yj,U.m5),F=(0,i.Z)(L,2),R=F[0],H=F[1],D=(0,m.useReducer)(Z,w),V=(0,i.Z)(D,2),K=V[0],A=V[1],z=(0,m.useState)(window.visualViewport.height),B=(0,i.Z)(z,2),O=B[0],W=B[1],Y=(0,m.useState)(!1),Q=(0,i.Z)(Y,2),P=Q[0],X=Q[1],G=(0,m.useState)(""),q=(0,i.Z)(G,2),$=q[0],ee=q[1],se=function(){var e=(0,r.Z)((0,a.Z)().mark((function e(){var s,r,i,d,c,o,u;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=$,ee(""),""===s){e.next=29;break}return i=(0,y.Z)(),d=h.EK.now(),e.next=7,(0,h.r7)((0,h.JU)(M,"chats",J.id),{messages:(0,h.vr)({id:i,messageText:s,userId:t.id,date:d,photo:t.photo,name:t.name,deleted:!1})});case 7:return e.next=9,(0,h.r7)((0,h.JU)(M,"chatsList",t.id),(r={},(0,n.Z)(r,J.id+".lastMessage",{messageText:s}),(0,n.Z)(r,J.id+".date",(0,h.Bt)()),(0,n.Z)(r,J.id+".viewMessage",{newMessView:!0,idSender:t.id,viewMess:!1}),r));case 9:if(!J.users){e.next=23;break}e.t0=(0,a.Z)().keys(J.users);case 11:if((e.t1=e.t0()).done){e.next=21;break}return c=e.t1.value,e.next=15,(0,h.QT)((0,h.JU)(M,"chatsList",c));case 15:if(!e.sent.exists()){e.next=19;break}return e.next=19,(0,h.r7)((0,h.JU)(M,"chatsList",c),(o={},(0,n.Z)(o,J.id+".lastMessage",{messageText:s}),(0,n.Z)(o,J.id+".date",(0,h.Bt)()),(0,n.Z)(o,J.id+".viewMessage",{newMessView:!1,idSender:t.id,viewMess:!1}),o));case 19:e.next=11;break;case 21:e.next=29;break;case 23:return e.next=25,(0,h.QT)((0,h.JU)(M,"chatsList",J.friendId));case 25:if(!e.sent.exists()){e.next=29;break}return e.next=29,(0,h.r7)((0,h.JU)(M,"chatsList",J.friendId),(u={},(0,n.Z)(u,J.id+".lastMessage",{messageText:s}),(0,n.Z)(u,J.id+".date",(0,h.Bt)()),(0,n.Z)(u,J.id+".viewMessage",{newMessView:!1,idSender:t.id,viewMess:!1}),u));case 29:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,m.useEffect)((function(){var e=(0,h.cf)((0,h.JU)(M,"chatsList",t.id),(function(e){var s=!!e.data()&&Object.entries(e.data());if(s){var a=s.find((function(e){return e[0]===J.id})),n=a&&a[1].viewMessage,r=n&&n.viewMess,i=n&&n.idSender,d=n&&n.newMessView;if(a&&a[1].chat){var c=a[0],o=a[1].name?a[1].name.name:"",u=a[1].photo.photo;if(a[1].deleted.deleted)return C((0,_.aE)({name:o,photo:u,combinedId:c})),void X(!0);C((0,_.aE)({name:o,photo:u,combinedId:c})),X(!1),C((0,_.XC)({newMess:d,view:r,combinedId:c,idSender:i}))}else if(a&&a[1].group){for(var g=a[0],l=Object.entries(a[1].group.users),m=a[1].group.users,f=Object.entries(J.users),h=0;h<l.length;h++)l[h][1].deleted!==f[h][1].deleted&&C((0,v.ei)({combinedId:g,users:m})),l[h][1].admin&&l[h][1].id===t.id&&H({type:"admin",payload:!0});C((0,v._U)({newMess:d,view:r,combinedId:g,idSender:i}))}}}));return function(){e()}}),[J]),(0,m.useEffect)((function(){if(null!==x.current){var e=f.current.offsetHeight,s=p.current.offsetHeight,t=window.visualViewport.height-(e+s);x.current.style.height="".concat(t,"px"),x.current.scrollTop=x.current.scrollHeight}}),[O]),(0,b.jsx)("section",{className:o.messagesSec,children:(0,b.jsxs)("div",{className:g()(o.container,"container"),children:[(0,b.jsxs)("header",{className:o.header,ref:f,children:[(0,b.jsxs)("div",{className:o.user,children:[R.admin&&(0,b.jsx)(c.rU,{state:J,to:"/edit-group",children:(0,b.jsx)("img",{className:o.editIcon,src:E.Z,alt:"edit"})}),(0,b.jsx)("div",{className:o.userImg,children:(0,b.jsx)("img",{src:null!==J.photo?J.photo:k,alt:"User"})}),(0,b.jsx)("div",{className:o.about,children:(0,b.jsx)("h2",{className:o.name,children:J.name})})]}),(0,b.jsx)("div",{onClick:function(){u("/")},className:o.back,children:(0,b.jsx)("img",{src:S.Z,alt:"back"})})]}),(0,b.jsx)("section",{ref:x,id:"scroll",className:K.modal?g()(o.noScroll,o.messages):o.messages,children:(0,b.jsx)(N,{stateEditMess:[K,A],setSizeWindow:W,scrollRef:x,infoChat:J})}),P?(0,b.jsx)("div",{ref:p,className:g()(o.deletedInput),children:"Account has been deleted"}):(0,b.jsx)(j,{stateEditMess:[K,A],infoChat:J,scrollRef:x,setSizeWindow:W,innerRef:p,handleEvent:function(e){"Enter"===e.code&&!1===e.ctrlKey&&!1===e.shiftKey&&(e.preventDefault(),se())},sendMess:se,text:$,setMessageText:ee})]})})}}}]);
//# sourceMappingURL=804.03fe4ba7.chunk.js.map