"use strict";(self.webpackChunkmy_app=self.webpackChunkmy_app||[]).push([[949],{8552:function(e,s,n){n(2791);s.Z=n.p+"static/media/edit.666b6fca3a40a0415e39054d202d0667.svg"},949:function(e,s,n){n.r(s),n.d(s,{default:function(){return N}});var a=n(4165),t=n(4942),i=n(5861),r=n(885),d=n(7689),c=n(1087),o={header:"MessagesMain_header__EMkYa",or:"MessagesMain_or__g5wuD",user:"MessagesMain_user__TDMJA",userImg:"MessagesMain_userImg__Mop0A",name:"MessagesMain_name__58IH7",online:"MessagesMain_online__FByeQ",dots:"MessagesMain_dots__9N9pU",container:"MessagesMain_container__c2E6N",input:"MessagesMain_input__R5zJ0",send:"MessagesMain_send__tKhge",textArea:"MessagesMain_textArea__v6811",messages:"MessagesMain_messages__eWIbA",empty:"MessagesMain_empty__Un+PR",messagesMe:"MessagesMain_messagesMe__Go3UK",messagesFriend:"MessagesMain_messagesFriend__4kSKR",messageContainerMe:"MessagesMain_messageContainerMe__GIXeF",messageContainerFriend:"MessagesMain_messageContainerFriend__6diH7",dateMe:"MessagesMain_dateMe__XY83U",dateFriend:"MessagesMain_dateFriend__Iu9Pj",dateMessages:"MessagesMain_dateMessages__HlrtQ",deletedInput:"MessagesMain_deletedInput__caMDW",back:"MessagesMain_back__-Z3YD",photoSender:"MessagesMain_photoSender__ZMI70",imgSenderBlock:"MessagesMain_imgSenderBlock__ZJrLC",infoSender:"MessagesMain_infoSender__9F9Tj",desactiveName:"MessagesMain_desactiveName__KMp2g",nameSender:"MessagesMain_nameSender__1ewyf",nameSenderText:"MessagesMain_nameSenderText__-gZpe",editIcon:"MessagesMain_editIcon__8-EL3"},u=n(1694),g=n.n(u),l=n(9434),f=n(2791),m=n(9062);var h=n.p+"static/media/send.e6e41f470c70eedfe79bcc21222a7720.svg",M=n(184);function p(e){var s=e.setSizeWindow,n=e.sendMess,r=e.text,d=e.setMessageText,c=e.handleEvent,u=e.innerRef,g=e.infoChat,p=(0,l.v9)((function(e){return e.user})),_=(0,m.ad)();(0,f.useEffect)((function(){function e(){var e=window.visualViewport.height;s(e)}return window.addEventListener("resize",e),function(){e()}}),[]);var v=function(){var e=(0,i.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,m.r7)((0,m.JU)(_,"chatsList",p.id),(0,t.Z)({},"".concat(g.id,".viewMessage.newMessView"),!0));case 3:if(!g.users){e.next=8;break}Object.entries(g.users).map(function(){var e=(0,i.Z)((0,a.Z)().mark((function e(s){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!1!==s[1].deleted||s[0]===p.id){e.next=3;break}return e.next=3,(0,m.r7)((0,m.JU)(_,"chatsList",s[0]),(0,t.Z)({},"".concat(g.id,".viewMessage.viewMess"),!0));case 3:case"end":return e.stop()}}),e)})));return function(s){return e.apply(this,arguments)}}()),e.next=10;break;case 8:return e.next=10,(0,m.r7)((0,m.JU)(_,"chatsList",g.friendId),(0,t.Z)({},"".concat(g.id,".viewMessage.viewMess"),!0));case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),console.error(e.t0);case 15:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(){return e.apply(this,arguments)}}();return(0,M.jsxs)("section",{className:o.textArea,ref:u,children:[(0,M.jsx)("textarea",{onClick:function(){return v()},placeholder:"Enter your message",onKeyDown:c,value:r,onChange:function(e){return d(e.target.value)},name:"messages",id:"textarea",type:"text",className:o.input,rows:"1"}),(0,M.jsx)("button",{onClick:function(){return n()},type:"submit",className:o.send,children:(0,M.jsx)("img",{src:h,alt:"Send"})})]})}var _=n(4261),v=n(3825),x=n(4229),w=n(4244),j=n(4778),I=n(3249),S=n(9594);function Z(e){var s=e.setSizeWindow,n=e.infoChat,a=e.scrollRef,t=(0,l.v9)((function(e){return e.message.messages})),i=(0,l.v9)((function(e){return e.user})),r=t.find((function(e){return e.chatId===n.id})),d=(0,m.ad)(),c=(0,l.I0)(),u=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];return(0,f.useEffect)((function(){a.current.scrollTop=a.current.scrollHeight}),[t]),(0,f.useEffect)((function(){return window.addEventListener("onload",s(window.visualViewport.height)),function(){return window.addEventListener("resize",s(window.visualViewport.height))}}),[t,window.innerHeight]),(0,f.useEffect)((function(){var e=(0,m.cf)((0,m.JU)(d,"chats",n.id),(function(e){if(!e.data())return!1;var s=e.data(),a=n.id;s.messages.map((function(e){var s=e.userId,n=e.messageText,t=e.id,i=e.date,d=e.photo,o=e.name,g=u[i.toDate().getDay()],l=i.toDate().getHours(),f=i.toDate().getMinutes().toString();1===f.length&&(f="0".concat(f));var m="".concat(g," ").concat(l,":").concat(f);if(r&&r.messages){var h=r.messages.find((function(e){return e.messageId===t}));void 0!==h&&void 0!==h.photo&&void 0!==d&&h.photo!==d&&c((0,I.xK)({messageId:t,chatId:a,photo:d})),void 0!==h&&void 0!==h.name&&void 0!==o&&h.name!==o&&c((0,I.y1)({messageId:t,chatId:a,name:o}))}c((0,I.Hz)({name:o,chatId:a,userId:s,messageText:n,datePush:m,messageId:t,photo:d}))}))}));return function(){e()}}),[r]),t.length>0&&r?r.messages.map((function(e){return e.userId===i.id?(0,M.jsxs)("div",{className:o.messageContainerMe,children:[(0,M.jsxs)("span",{className:g()("message",o.messagesMe),children:[(0,M.jsx)("span",{children:e.text}),(0,M.jsx)("span",{className:g()(o.dateMessages,o.dateMe),children:e.date})]}),(0,M.jsx)("span",{className:o.infoSender,children:(0,M.jsx)("span",{className:o.imgSenderBlock,children:(0,M.jsx)("img",{className:o.photoSender,src:e.photo?e.photo:v,alt:"Photo user"})})})]},e.messageId):(0,M.jsxs)("div",{className:o.messageContainerFriend,children:[(0,M.jsxs)("span",{className:o.infoSender,children:[(0,M.jsx)("span",{className:o.imgSenderBlock}),(0,M.jsx)("img",{className:o.photoSender,src:e.photo?e.photo:v,alt:"Photo user"})]}),(0,M.jsxs)("span",{className:g()("message",o.messagesFriend),children:[(0,M.jsx)("span",{children:e.text}),(0,M.jsx)("span",{className:g()(o.dateMessages,o.dateFriend),children:e.date})]})]},e.messageId)})):(0,M.jsx)(S.H,{text:"No Messages"})}var b=n(9232),k=n(8552);function N(){var e=(0,l.v9)((function(e){return e.friend.friend})),s=(0,l.v9)((function(e){return e.group.group})),n=(0,l.v9)((function(e){return e.user})),u=(0,d.s0)(),h=(0,f.useRef)(),I=(0,f.useRef)(),S=(0,f.useRef)(),N=(0,m.ad)(),y=Object.values((0,d.UO)()),E=(0,r.Z)(y,1)[0],U=e.find((function(e){return e.id===E}))?e.find((function(e){return e.id===E})):s.find((function(e){return e.id===E})),C=(0,l.I0)(),T=(0,f.useReducer)(b.Yj,b.m5),J=(0,r.Z)(T,2),L=J[0],F=J[1],R=(0,f.useState)(window.visualViewport.height),H=(0,r.Z)(R,2),D=H[0],V=H[1],K=(0,f.useState)(!1),z=(0,r.Z)(K,2),B=z[0],A=z[1],W=(0,f.useState)(""),O=(0,r.Z)(W,2),P=O[0],Q=O[1],Y=function(){var e=(0,i.Z)((0,a.Z)().mark((function e(){var s,i,r,d,c,o,u;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=P,Q(""),""===s){e.next=29;break}return r=(0,_.Z)(),d=m.EK.now(),e.next=7,(0,m.r7)((0,m.JU)(N,"chats",U.id),{messages:(0,m.vr)({id:r,messageText:s,userId:n.id,date:d,photo:n.photo,name:n.name,deleted:!1})});case 7:return e.next=9,(0,m.r7)((0,m.JU)(N,"chatsList",n.id),(i={},(0,t.Z)(i,U.id+".lastMessage",{messageText:s}),(0,t.Z)(i,U.id+".date",(0,m.Bt)()),(0,t.Z)(i,U.id+".viewMessage",{newMessView:!0,idSender:n.id,viewMess:!1}),i));case 9:if(!U.users){e.next=23;break}e.t0=(0,a.Z)().keys(U.users);case 11:if((e.t1=e.t0()).done){e.next=21;break}return c=e.t1.value,e.next=15,(0,m.QT)((0,m.JU)(N,"chatsList",c));case 15:if(!e.sent.exists()){e.next=19;break}return e.next=19,(0,m.r7)((0,m.JU)(N,"chatsList",c),(o={},(0,t.Z)(o,U.id+".lastMessage",{messageText:s}),(0,t.Z)(o,U.id+".date",(0,m.Bt)()),(0,t.Z)(o,U.id+".viewMessage",{newMessView:!1,idSender:n.id,viewMess:!1}),o));case 19:e.next=11;break;case 21:e.next=29;break;case 23:return e.next=25,(0,m.QT)((0,m.JU)(N,"chatsList",U.friendId));case 25:if(!e.sent.exists()){e.next=29;break}return e.next=29,(0,m.r7)((0,m.JU)(N,"chatsList",U.friendId),(u={},(0,t.Z)(u,U.id+".lastMessage",{messageText:s}),(0,t.Z)(u,U.id+".date",(0,m.Bt)()),(0,t.Z)(u,U.id+".viewMessage",{newMessView:!1,idSender:n.id,viewMess:!1}),u));case 29:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,f.useEffect)((function(){var e=(0,m.cf)((0,m.JU)(N,"chatsList",n.id),(function(e){var s=!!e.data()&&Object.entries(e.data());if(s){var a=s.find((function(e){return e[0]===U.id})),t=a&&a[1].viewMessage,i=t.viewMess,r=t.idSender,d=t.newMessView;if(a&&a[1].chat){var c=a[0],o=a[1].name?a[1].name.name:"",u=a[1].photo.photo;if(a[1].deleted.deleted)return C((0,x.aE)({name:o,photo:u,combinedId:c})),void A(!0);C((0,x.aE)({name:o,photo:u,combinedId:c})),A(!1),C((0,x.XC)({newMess:d,view:i,combinedId:c,idSender:r}))}else if(a&&a[1].group){for(var g=a[0],l=Object.entries(a[1].group.users),f=a[1].group.users,m=Object.entries(U.users),h=0;h<l.length;h++)l[h][1].deleted!==m[h][1].deleted&&C((0,j.ei)({combinedId:g,users:f})),l[h][1].admin&&l[h][1].id===n.id&&F({type:"admin",payload:!0});C((0,j._U)({newMess:d,view:i,combinedId:g,idSender:r}))}}}));return function(){e()}}),[U]),(0,f.useEffect)((function(){if(null!==I.current){var e=h.current.offsetHeight,s=S.current.offsetHeight,n=window.visualViewport.height-(e+s);I.current.style.height="".concat(n,"px"),I.current.scrollTop=I.current.scrollHeight}}),[D]),(0,M.jsx)("section",{className:o.messagesSec,children:(0,M.jsxs)("div",{className:g()(o.container,"container"),children:[(0,M.jsxs)("header",{className:o.header,ref:h,children:[(0,M.jsxs)("div",{className:o.user,children:[L.admin&&(0,M.jsx)(c.rU,{state:U,to:"/edit-group",children:(0,M.jsx)("img",{className:o.editIcon,src:k.Z,alt:"edit"})}),(0,M.jsx)("div",{className:o.userImg,children:(0,M.jsx)("img",{src:null!==U.photo?U.photo:v,alt:"User"})}),(0,M.jsx)("div",{className:o.about,children:(0,M.jsx)("h2",{className:o.name,children:U.name})})]}),(0,M.jsx)("div",{onClick:function(){u("/")},className:o.back,children:(0,M.jsx)("img",{src:w.Z,alt:"back"})})]}),(0,M.jsx)("section",{ref:I,id:"scroll",className:o.messages,children:(0,M.jsx)(Z,{setSizeWindow:V,scrollRef:I,infoChat:U})}),B?(0,M.jsx)("div",{ref:S,className:g()(o.deletedInput),children:"Account has been deleted"}):(0,M.jsx)(p,{infoChat:U,scrollRef:I,setSizeWindow:V,innerRef:S,handleEvent:function(e){"Enter"===e.code&&!1===e.ctrlKey&&!1===e.shiftKey&&(e.preventDefault(),Y())},sendMess:Y,text:P,setMessageText:Q})]})})}}}]);
//# sourceMappingURL=949.971e5e66.chunk.js.map